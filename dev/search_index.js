var documenterSearchIndex = {"docs":
[{"location":"climate/microclimate/#microclimate_page","page":"Micro-climate","title":"Micro-climate","text":"","category":"section"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using PlantBiophysics, PlantMeteo","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"The micro-climatic/meteorological conditions measured close to the object or component are given as the second argument of the simulation functions shown earlier.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"PlantBiophysics usually uses a special data structure from the PlantMeteo package to declare those conditions, and to pre-compute other required variables. This data structure is a type called Atmosphere.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"The mandatory variables to provide are: T (air temperature in °C), Rh (relative humidity, 0-1), Wind (the wind speed in m s-1) and P (the air pressure in kPa).","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"We can declare such conditions using Atmosphere such as:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"The Atmosphere also computes other variables based on the provided conditions, such as the vapor pressure deficit (VPD) or the air density (ρ). You can also provide those variables as inputs if necessary. For example if you need another way of computing the VPD, you can provide it as follows:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using PlantMeteo\nAtmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65, VPD = 0.82)","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"To access the values of the variables after instantiation, we can use the dot syntax. For example if we need the vapor pressure at saturation, we would do as follows:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"meteo.eₛ","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"See the documentation of the function if you need more information about the variables: Atmosphere.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"If you want to simulate several time-steps with varying conditions, you can do so by using Weather instead of Atmosphere.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"Weather is just an array of Atmosphere along with some optional metadata. For example for three time-steps, we can declare it like so:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using PlantMeteo\nw = Weather(\n    [\n        Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65),\n        Atmosphere(T = 23.0, Wind = 1.5, P = 101.3, Rh = 0.60),\n        Atmosphere(T = 25.0, Wind = 3.0, P = 101.3, Rh = 0.55)\n    ],\n    (\n        site = \"Montpellier\",\n        other_info = \"another crucial metadata\"\n    )\n)","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"As you see the first argument is an array of Atmosphere, and the second is a named tuple of optional metadata such as the site or whatever you think is important.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"A Weather can also be declared from a DataFrame, provided each row is an observation from a time-step, and each column is a variable needed for Atmosphere (see the help of Atmosphere for more details on the possible variables and their units).","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"Here's an example of using a DataFrame as input:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using CSV, DataFrames, PlantMeteo\nfile = joinpath(dirname(dirname(pathof(PlantMeteo))),\"test\",\"data\",\"meteo.csv\")\ndf = CSV.read(file, DataFrame; header=5, skipto = 6, dateformat = \"yyyy/mm/dd\")\n# Select and rename the variables:\nselect!(df, :date, :temperature => :T, :relativeHumidity => (x -> x ./ 100 ) => :Rh, :wind => :Wind, :atmosphereCO2_ppm => :Cₐ)\ndf[!,:duration] .= 1800 # Add the time-step duration, 30min\n\n# Make the weather, and add some metadata:\nWeather(df, (site = \"Aquiares\", file = file))","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"One can also directly import the Weather from an Archimed-ϕ-formatted meteorology file (a csv file optionally enriched with some metadata). In this case, the user can rename and transform the variables from the file to match the names and units needed in PlantBiophysics using a DataFrame.jl-alike syntax:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"using Dates, PlantMeteo\n\nmeteo = read_weather(\n    joinpath(dirname(dirname(pathof(PlantMeteo))),\"test\",\"data\",\"meteo.csv\"),\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)","category":"page"},{"location":"climate/microclimate/#Helper-functions","page":"Micro-climate","title":"Helper functions","text":"","category":"section"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"PlantBiophysics provides some helper functions to compute some micro-climate related variables.","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"Here is a complete list of these functions:","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"vapor_pressure computes e (kPa), the vapor pressure from the air temperature and the relative humidity\ne_sat computes eₛ (kPa), the saturated vapor pressure from the air temperature\nair_density computes ρ (kg m-3), the air density from the air temperature, the pressure, and some constants\nlatent_heat_vaporization computes λ (J kg-1), the latent heat of vaporization from the air temperature and a constant\npsychrometer_constant computes γ (kPa K−1), the psychrometer \"constant\" from the air pressure, the latent heat of vaporization and some constants\natmosphere_emissivity(T,e,constants.K₀) computes ε (0-1), the atmosphere emissivity from the air temperature, the vapor pressure and a constant\ne_sat_slope computes Δ (0-1), the slope of the saturation vapor pressure at air temperature, from the air temperature","category":"page"},{"location":"climate/microclimate/","page":"Micro-climate","title":"Micro-climate","text":"note: Note\nAll constants are found in Constants","category":"page"},{"location":"getting_started/first_fit/#First-parameter-fitting","page":"Parameter fitting","title":"First parameter fitting","text":"","category":"section"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"Parameter fitting is also at the heart of the package, because why making a simulation without good parameter values?","category":"page"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"The package provides a fit method that helps fitting model parameters to data.","category":"page"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"For example we provide a method to fit the parameters from the Farquhar et al. (1980) model (Fvcb). Here is an example usage:","category":"page"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"using PlantBiophysics, PlantSimEngine, DataFrames\n\ndf = read_walz(joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\",\"P1F20129.csv\"))\n# Removing the Rh and light curves for the fitting because temperature varies\nfilter!(x -> x.curve != \"Rh Curve\" && x.curve != \"ligth Curve\", df)\n\n# Fit the parameter values:\nVcMaxRef, JMaxRef, RdRef, TPURef = fit(Fvcb, df; Tᵣ = 25.0)","category":"page"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"The fitting method uses the leaf temperature (Tₗ, °C), the Photosynthetic Photon Flux Density (PPFD, μmol m⁻² s⁻¹) and the intercellular CO₂ concentration (Cᵢ, ppm) from the data to fit the four main parameters of the model.","category":"page"},{"location":"getting_started/first_fit/#Wrap-up","page":"Parameter fitting","title":"Wrap-up","text":"","category":"section"},{"location":"getting_started/first_fit/","page":"Parameter fitting","title":"Parameter fitting","text":"We learned to make a simple parameter fitting. For more information, you can head over the Parameter fitting section.","category":"page"},{"location":"fitting/parameter_fitting/#Parameter-fitting","page":"Tutorial: Parameter fitting","title":"Parameter fitting","text":"","category":"section"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"fitting/parameter_fitting/#The-fit-method","page":"Tutorial: Parameter fitting","title":"The fit method","text":"","category":"section"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"The package provides methods to the generic fit function from PlantSimEngine to calibrate a model with data.","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"The arguments depends on the methods, but usually takes several parameters:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"the model type, e.g. FvCB\na DataFrame with the data (depends on the given method)\nkeyword arguments (also depend on the fit method)","category":"page"},{"location":"fitting/parameter_fitting/#Example-with-FvCB","page":"Tutorial: Parameter fitting","title":"Example with FvCB","text":"","category":"section"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"A fit method is provided by the package to calibrate the parameters of the FvCB model (Farquhar et al., 1980).","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"Here is an example usage from the documentation of the method:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"using PlantBiophysics, PlantSimEngine\nusing DataFrames, Plots\n\ndf = read_walz(joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\",\"P1F20129.csv\"))\n# Removing the Rh and light curves for the fitting because temperature varies\nfilter!(x -> x.curve != \"Rh Curve\" && x.curve != \"ligth Curve\", df)\n\n# Fit the parameter values:\nVcMaxRef, JMaxRef, RdRef, TPURef = fit(Fvcb, df; Tᵣ = 25.0)","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"Now that our parameters are optimized, we can check how close to the data a simulation would get.","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"First, let's select only the data used for the CO₂ curve:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"# Checking the results:\nfilter!(x -> x.curve == \"CO2 Curve\", df)\nnothing # hide","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"Now let's re-simulate the assimilation with our optimized parameter values:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"leaf =\n    ModelList(\n        FvcbRaw(VcMaxRef = VcMaxRef, JMaxRef = JMaxRef, RdRef = RdRef, TPURef = TPURef),\n        status = (Tₗ = df.Tₗ, PPFD = df.PPFD, Cᵢ = df.Cᵢ)\n    )\nrun!(leaf)\ndf_sim = DataFrame(leaf);","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"Finally, we can make an A-Cᵢ plot using our custom ACi structure as follows:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"aci = PlantBiophysics.ACi(VcMaxRef, JMaxRef, RdRef, df[:,:A], df_sim[:,:A], df[:,:Cᵢ], df_sim[:,:Cᵢ])\nplot(aci, leg=:bottomright)","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"Our simulation fits very closely the observations, nice!","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"There are another implementation of the FvCB model in our package. One that couples the photosynthesis with the stomatal conductance. And this one computes Cᵢ too. Let's check if it works with this one too by using dummy parameter values for the conductance model:","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"leaf = ModelList(\n        Fvcb(VcMaxRef = VcMaxRef, JMaxRef = JMaxRef, RdRef = RdRef, Tᵣ = 25.0, TPURef = TPURef),\n        Medlyn(0.03, 12.),\n        status = (Tₗ = df.Tₗ, PPFD = df.PPFD, Cₛ = df.Cₐ, Dₗ = 0.1)\n    )\n\nw = Weather(select(df, :T, :P, :Rh, :Cₐ, :T => (x -> 10) => :Wind))\nrun!(leaf, w)\ndf_sim2 = DataFrame(leaf)\n\naci2 = PlantBiophysics.ACi(VcMaxRef, JMaxRef, RdRef, df[:,:A], df_sim2[:,:A], df[:,:Cᵢ], df_sim2[:,:Cᵢ])\nplot(aci2, leg = :bottomright)","category":"page"},{"location":"fitting/parameter_fitting/","page":"Tutorial: Parameter fitting","title":"Tutorial: Parameter fitting","text":"We can see the results differ a bit, but it is because we add a lot more computation here, hence adding some degrees of liberty.","category":"page"},{"location":"getting_started/get_started/#First-simulation","page":"TL;DR","title":"First simulation","text":"","category":"section"},{"location":"getting_started/get_started/","page":"TL;DR","title":"TL;DR","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames","category":"page"},{"location":"getting_started/get_started/","page":"TL;DR","title":"TL;DR","text":"Make your first simulation for a leaf energy balance, photosynthesis and stomatal conductance altogether with few lines of codes:","category":"page"},{"location":"getting_started/get_started/","page":"TL;DR","title":"TL;DR","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames\n\nmeteo = read_weather(\n    joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    :Re_SW_f => :Ri_SW_f,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 7.0),\n        status = (\n            Rₛ = meteo[:Ri_SW_f] .* 0.8,\n            sky_fraction = 1.0,\n            PPFD = meteo[:Ri_SW_f] .* 0.8 .* 0.48 .* 4.57,\n            d = 0.03\n        )\n)\n\nrun!(leaf,meteo)\n\nDataFrame(leaf)","category":"page"},{"location":"getting_started/get_started/","page":"TL;DR","title":"TL;DR","text":"Curious to understand more ? Head to the next section to learn more about parameter fitting, or to the Simple simulation section for more details about how to make simulations.","category":"page"},{"location":"simulation/several_objects_simulation/#Simulation-over-several-components","page":"Several objects","title":"Simulation over several components","text":"","category":"section"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames","category":"page"},{"location":"simulation/several_objects_simulation/#Running-the-simulation","page":"Several objects","title":"Running the simulation","text":"","category":"section"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"We saw in the previous sections how to run a simulation over one and several time-steps.","category":"page"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"Now it is also very easy to run a simulation for different components by just providing an array of component instead:","category":"page"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames\n\nmeteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)\n\nleaf1 = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n    )\n\nleaf2 = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 10., sky_fraction = 1.0, PPFD = 1250.0, d = 0.02)\n    )\n\nrun!([leaf1, leaf2], meteo)\n\nDataFrame(Dict(\"leaf1\" => leaf1, \"leaf2\" => leaf2))","category":"page"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"Note that we use a Dict of components in the call to DataFrame because it allows to get a component column to retrieve the component in the DataFrame, but we could also just use an Array instead.","category":"page"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"A simulation over different time-steps would give:","category":"page"},{"location":"simulation/several_objects_simulation/","page":"Several objects","title":"Several objects","text":"meteo =\n    read_weather(\n        joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n        :temperature => :T,\n        :relativeHumidity => (x -> x ./ 100) => :Rh,\n        :wind => :Wind,\n        :atmosphereCO2_ppm => :Cₐ,\n        date_format=DateFormat(\"yyyy/mm/dd\")\n    )\n\nleaf1 = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (\n            Rₛ = [5., 10., 20.],\n            sky_fraction = 1.0,\n            PPFD = [500., 1000., 1500.0],\n            d = 0.03\n        )\n    )\n\nleaf2 = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (\n            Rₛ = [3., 7., 16.],\n            sky_fraction = 1.0,\n            PPFD = [400., 800., 1200.0],\n            d = 0.03\n        )\n    )\n\nrun!([leaf1, leaf2], meteo)\n\nDataFrame(Dict(\"leaf1\" => leaf1, \"leaf2\" => leaf2))","category":"page"},{"location":"simulation/several_simulation/#Simulation-over-several-time-steps","page":"Several time steps","title":"Simulation over several time-steps","text":"","category":"section"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames\n","category":"page"},{"location":"simulation/several_simulation/#Running-the-simulation","page":"Several time steps","title":"Running the simulation","text":"","category":"section"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"We saw in the previous section how to run a simulation over one time step. We can also easily perform computations over several time steps from a weather file:","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing Dates, DataFrames\n\nmeteo =\n    read_weather(\n        joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n        :temperature => :T,\n        :relativeHumidity => (x -> x ./ 100) => :Rh,\n        :wind => :Wind,\n        :atmosphereCO2_ppm => :Cₐ,\n        date_format=DateFormat(\"yyyy/mm/dd\")\n    )\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (\n            Rₛ = [5., 10., 20.],\n            sky_fraction = 1.0,\n            PPFD = [500., 1000., 1500.0],\n            d = 0.03\n        )\n    )\n\nrun!(leaf,meteo)\n\nDataFrame(leaf)","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"The only difference is that we use the Weather structure instead of the Atmosphere, and that we provide the models inputs as an Array in the status for the ones that change over time.","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"Then PlantBiophysics.jl takes care of the rest and simulate the energy balance over each time-step. Then the output DataFrame has a row for each time-step.","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"Note that Weather is in fact just an array of Atmosphere, with some optional metadata attached to it. We could declare one manually either by using an array of Atmosphere like so:","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"meteo = Weather(\n    [\n        Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65),\n        Atmosphere(T = 23.0, Wind = 1.5, P = 101.3, Rh = 0.60),\n        Atmosphere(T = 25.0, Wind = 3.0, P = 101.3, Rh = 0.55)\n    ]\n)","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"Or by passing a DataFrame:","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"using DataFrames\n\ndf = DataFrame(\n    T = [20.0, 23.0, 25.0],\n    Wind = [1.0, 1.5, 3.0],\n    P = [101.3, 101.3, 101.3],\n    Rh = [0.65, 0.6, 0.55]\n)\n\nmeteo = Weather(df)","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"You'll have to be careful about the names and the units you are using though, they must match exactly the ones expected for Atmosphere. See the documentation of the structure if in doubt.","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"The status argument of the ModelList can also be provided as a DataFrame, or any other type that implements the Tables.jl interface. Here's an example using a DataFrame:","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"using DataFrames\ndf = DataFrame(:Rₛ => [13.747, 13.8], :sky_fraction => [1.0, 1.0], :d => [0.03, 0.03], :PPFD => [1300.0, 1500.0])\n\nm = ModelList(Monteith(), Fvcb(), Medlyn(0.03, 12.0), status=df)","category":"page"},{"location":"simulation/several_simulation/","page":"Several time steps","title":"Several time steps","text":"Note that computations will be slower, so if performance is an issue, use TimeStepTable instead (or a NamedTuple as shown in the example above).","category":"page"},{"location":"models/photosynthesis/#photosynthesis_page","page":"Photosynthesis","title":"Photosynthesis","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The photosynthesis is, in this package, the process of assimilation of the atmospheric CO₂.","category":"page"},{"location":"models/photosynthesis/#Models-overview","page":"Photosynthesis","title":"Models overview","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Several models are available to simulate it:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Fvcb: an implementation of the Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981) using an analytical resolution\nFvcbIter: the same model but implemented using an iterative computation over Cᵢ\nFvcbRaw: the same model but without the coupling with the stomatal conductance, i.e. as presented in the original paper. This version needs Cᵢ as input.\nConstantA: a model to set the assimilation to a constant value (mainly for testing)\nConstantAGs: a model to set the assimilation to a constant value, but coupled to a stomatal conductance model to compute Cᵢ (mainly for testing)","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"You can choose which model to use by passing a component with an assimilation model set to one of the struct above.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"For example, you can \"simulate\" a constant assimilation for a leaf using the following:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"using PlantBiophysics, PlantSimEngine\nleaf = ModelList(ConstantA(25.0))\nrun!(leaf)","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"This model does one thing only: force the photosynthesis to the value given as a parameter in the model, here 25.0 μmol cdot m^-2 cdot s^-1.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"note: Note\nThis model feels useless here, but it can be useful when coupled with other models, for example when simulating the full energy balance with a coupled photosynthesis and stomatal conductance model. In this case it is used to better understand how the energy balance works for a given assimilation.","category":"page"},{"location":"models/photosynthesis/#Fvcb","page":"Photosynthesis","title":"Fvcb","text":"","category":"section"},{"location":"models/photosynthesis/#param_fvcb","page":"Photosynthesis","title":"Parameters","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The FvCB model has a lot of parameters:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Tᵣ: reference temperature (°C) at which other parameters were measured\nVcMaxRef: maximum rate of Rubisco activity (μmol cdot m^-2 cdot s^-1)\nJMaxRef: potential rate of electron transport (μmol cdot m^-2 cdot s^-1)\nRdRef: mitochondrial respiration in the light at reference temperature (μmol cdot m^-2 cdot s^-1)\nTPURef: triose phosphate utilization-limited photosynthesis rate (μmol cdot m^-2 cdot s^-1)\nEₐᵣ: activation energy (J cdot mol^-1), or the exponential rate of rise for Rd.\nO₂: intercellular dioxygen concentration (ppm)\nEₐⱼ: activation energy (J cdot mol^-1), or the exponential rate of rise for JMax.\nHdⱼ: rate of decrease of the function above the optimum (also called EDVJ) for JMax.\nΔₛⱼ: entropy factor for JMax.\nEₐᵥ: activation energy (J cdot mol^-1), or the exponential rate of rise for VcMax.\nHdᵥ: rate of decrease of the function above the optimum (also called EDVC) for VcMax.\nΔₛᵥ: entropy factor for VcMax.\nα: quantum yield of electron transport (mol_e cdot mol^-1_quanta). See also eq. 4 of Medlyn et al. (2002) and its implementation in get_J\nθ: determines the curvature of the light response curve for J~PPFD. See also eq. 4 of Medlyn et al. (2002) and its implementation in get_J","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The default values of the temperature correction parameters are taken from plantecophys (Duursma, 2015). If there is no negative effect of high temperatures on the reaction (Jmax or VcMax), then Δₛ can be set to 0.0.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The default value for θ is 0.7 according to Von Caemmerer (2000), but it can be modified to 0.9 as in Su et al. (2009). The larger it is, the lower the smoothing.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The default value for α is 0.24, taken from plantecophys.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Medlyn et al. (2002) found relatively low influence (\"a slight effect\") of α and θ. They also say that Kc, Ko and Γ* \"are thought to be intrinsic properties of the Rubisco enzyme and are generally assumed constant among species\".","category":"page"},{"location":"models/photosynthesis/#inputs_fvcb","page":"Photosynthesis","title":"Input variables","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The Fvcb model needs three input variables:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"inputs(Fvcb())","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The PPFD is the absorbed photosynthetically active photon flux density (μmol_quanta cdot m^-2 cdot s^-1). It is usually computed by a light interception model.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Tₗ is the leaf temperature in Celsius degree.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Cₛ (ppm) is the stomatal CO₂ concentration, usually computed using a conductance model.","category":"page"},{"location":"models/photosynthesis/#exemple_fvcb","page":"Photosynthesis","title":"Example","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Here is an example usage:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"meteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(\n    Fvcb(),\n    Medlyn(0.03, 12.0),\n    status = (Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n)\n# NB: we need to initialize `Tₗ`, `PPFD` and `Cₛ` for `FvCB`, and `Dₗ` for the stomatal conductance of Medlyn et al. (2011).\n\nrun!(leaf,meteo)\n\nleaf","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"note: Note\nYou can use inputs to get the variables needed for a given model, e.g.: inputs(Fvcb()), inputs(Medlyn(0.03, 12.0)), or better: inputs(Fvcb(), Medlyn(0.03, 12.0))","category":"page"},{"location":"models/photosynthesis/#FvcbIter","page":"Photosynthesis","title":"FvcbIter","text":"","category":"section"},{"location":"models/photosynthesis/#param_fvcbiter","page":"Photosynthesis","title":"Parameters","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"FvcbIter needs the exact same parameter values as Fvcb.","category":"page"},{"location":"models/photosynthesis/#inputs_fvcbiter","page":"Photosynthesis","title":"Input variables","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The only difference with Fvcb is that FvcbIter computes Cₛ, so we don't need it as input, but it needs Gbc instead, the boundary conductance for CO₂ (mol cdot m^-2 cdot s^-1).","category":"page"},{"location":"models/photosynthesis/#exemple_fvcbiter","page":"Photosynthesis","title":"Example","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Here is an example usage:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"meteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(\n    FvcbIter(),\n    Medlyn(0.03, 12.0),\n    status = (Tₗ = 25.0, PPFD = 1000.0, Gbc = 0.67, Dₗ = meteo.VPD)\n)\n\n# NB: we need to initialize `Tₗ`, `PPFD` and `Gbc` for `FvcbIter`, and `Dₗ` for the stomatal conductance of Medlyn et al. (2011).\n\nrun!(leaf,meteo,Constants())\n\nleaf","category":"page"},{"location":"models/photosynthesis/#FvcbRaw","page":"Photosynthesis","title":"FvcbRaw","text":"","category":"section"},{"location":"models/photosynthesis/#param_fvcbraw","page":"Photosynthesis","title":"Parameters","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"FvcbRaw needs again the exact same parameter values as Fvcb, and the same input variables.","category":"page"},{"location":"models/photosynthesis/#inputs_fvcbraw","page":"Photosynthesis","title":"Input variables","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The FvcbRaw model needs three input variables:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"inputs(FvcbRaw())","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"The PPFD is, again, the absorbed photosynthetically active photon flux density (μmol_quanta cdot m^-2 cdot s^-1). It is usually computed by a light interception model. Tₗ (°C) is the leaf temperature, and Cᵢ (ppm) is the intercellular CO₂ concentration, usually computed using a conductance model.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"note: Note\nThe three implementations of the FvCB model needs different input variables because they implement more or less coupling with other models.","category":"page"},{"location":"models/photosynthesis/#exemple_raw","page":"Photosynthesis","title":"Example","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"leaf = ModelList(\n    FvcbRaw(),\n    status = (Tₗ = 25.0, PPFD = 1000.0, Cᵢ = 400.0)\n)\n# NB: we need `Tₗ`, `PPFD` and `Cᵢ` as inputs (see `inputs`)\n\nrun!(leaf)\nleaf","category":"page"},{"location":"models/photosynthesis/#ConstantA","page":"Photosynthesis","title":"ConstantA","text":"","category":"section"},{"location":"models/photosynthesis/#param_constanta","page":"Photosynthesis","title":"Parameters","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"ConstantA has one parameter: the constant value for the assimilation (A, μmol cdot m^-2 cdot s^-1). Its only job is to force the value of A to the value of the parameter.","category":"page"},{"location":"models/photosynthesis/#inputs_constanta","page":"Photosynthesis","title":"Input variables","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"ConstantA doesn't need any input variable.","category":"page"},{"location":"models/photosynthesis/#exemple_constanta","page":"Photosynthesis","title":"Example","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"leaf = ModelList(ConstantA())\n\nrun!(leaf)\nleaf","category":"page"},{"location":"models/photosynthesis/#ConstantAGs","page":"Photosynthesis","title":"ConstantAGs","text":"","category":"section"},{"location":"models/photosynthesis/#param_constantags","page":"Photosynthesis","title":"Parameters","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"ConstantAGs has one parameter: the constant value for the assimilation (A, μmol cdot m^-2 cdot s^-1). Similarly to ConstantA, its job is to force the value of A to the value of the parameter, but this one adds a coupling with a stomatal conductance model to in fine compute Cᵢ (ppm), the intercellular CO₂ concentration.","category":"page"},{"location":"models/photosynthesis/#inputs_constantags","page":"Photosynthesis","title":"Input variables","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"ConstantAGs needs Cₛ as input variable. Cₛ (ppm) is the stomatal CO₂ concentration, usually computed using a conductance model.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"inputs(ConstantAGs())","category":"page"},{"location":"models/photosynthesis/#exemple_constantags","page":"Photosynthesis","title":"Example","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"leaf = ModelList(\n    ConstantAGs(),\n    Medlyn(0.03, 12.0),\n    status = (Cₛ = 380.0, Dₗ = 2.0)\n)\n\nrun!(leaf)\nleaf","category":"page"},{"location":"models/photosynthesis/#Parameter-effects","page":"Photosynthesis","title":"Parameter effects","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"We can easily investigate the effects of parameters on the simulation. For example we can see what is the effect of PPFD on J.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"First we import the packages needed:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"using Plots\nusing PlantBiophysics, PlantSimEngine","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Then we set up our models and their parameter values:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"A = Fvcb(); PPFD = 0:100:2000;","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"And finally we plot J ~ PPFD with different parameter values, with the simplification that JMax is equal to JMaxRef:","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"plot(x -> PlantBiophysics.get_J(x, A.JMaxRef, A.α, A.θ), PPFD, xlabel = \"PPFD (μmol m⁻² s⁻¹)\",\n            ylab = \"J (μmol m⁻² s⁻¹)\", label = \"Default values\", legend = :bottomright)\nplot!(x -> PlantBiophysics.get_J(x, A.JMaxRef, A.α, A.θ * 0.5), PPFD, label = \"θ * 0.5\")\nplot!(x -> PlantBiophysics.get_J(x, A.JMaxRef, A.α * 0.5, A.θ), PPFD, label = \"α * 0.5\")\nsavefig(\"f-plot.svg\"); nothing # hide","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"(Image: Effect of PPFD on J)","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"You can investigate other relationships with different plots.","category":"page"},{"location":"models/photosynthesis/#References","page":"Photosynthesis","title":"References","text":"","category":"section"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Caemmerer, S. von, et G. D. Farquhar. 1981. « Some Relationships between the Biochemistry of Photosynthesis and the Gas Exchange of Leaves ». Planta 153 (4): 376‑87. https://doi.org/10.1007/BF00384257.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Farquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Medlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Su, Y., Zhu, G., Miao, Z., Feng, Q. and Chang, Z. 2009. « Estimation of parameters of a biochemically based model of photosynthesis using a genetic algorithm ». Plant, Cell & Environment, 32: 1710-1723. https://doi.org/10.1111/j.1365-3040.2009.02036.x.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Von Caemmerer, Susanna. 2000. Biochemical models of leaf photosynthesis. Csiro publishing.","category":"page"},{"location":"models/photosynthesis/","page":"Photosynthesis","title":"Photosynthesis","text":"Duursma, R. A. 2015. « Plantecophys - An R Package for Analysing and Modelling Leaf Gas Exchange Data ». PLoS ONE 10(11): e0143346. https://doi:10.1371/journal.pone.0143346.","category":"page"},{"location":"functions/#Functions","page":"API","title":"Functions","text":"","category":"section"},{"location":"functions/#Index","page":"API","title":"Index","text":"","category":"section"},{"location":"functions/","page":"API","title":"API","text":"","category":"page"},{"location":"functions/#API-documentation","page":"API","title":"API documentation","text":"","category":"section"},{"location":"functions/","page":"API","title":"API","text":"Modules = [PlantBiophysics]\nPrivate = false","category":"page"},{"location":"functions/#PlantBiophysics.AbstractEnergy_BalanceModel","page":"API","title":"PlantBiophysics.AbstractEnergy_BalanceModel","text":"energy_balance process abstract model. \n\nAll models implemented to simulate the energy_balance process must be a subtype of this type, e.g.  struct MyEnergy_BalanceModel <: AbstractEnergy_BalanceModel end.\n\nYou can list all models implementing this process using subtypes:\n\nExamples\n\nsubtypes(AbstractEnergy_BalanceModel)\n\nEnergy balance process. This process computes the energy balance of objects,  meaning that it computes the net radiation, the sensible heat flux, and the  latent heat flux if necessary. It can be coupled with a photosynthesis  model in the case of plants leaves.\n\nAt the moment, two models are implemented in the package:\n\nMonteith: the model found in Monteith and Unsworth (2013)\nMissing: if no computation of the energy balance is needed\n\nNote\n\nSome models need input values for some variables. For example Monteith requires a value for Rₛ, d and sky_fraction. If you read the models from a file, you can use init_status! (see examples).\n\nExamples\n\nusing PlantMeteo, PlantSimEngine, PlantBiophysics\n\n# ---Simple example---\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\n# Using the model of Monteith and Unsworth (2013) for energy, Farquhar et al. (1980) for\n# photosynthesis, and Medlyn et al. (2011) for stomatal conductance:\nleaf =\n    ModelList(\n        energy_balance = Monteith(),\n        photosynthesis = Fvcb(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n    )\n\nrun!(leaf,meteo)\n\n# ---Using several components---\n\nleaf2 = copy(leaf)\nleaf2[:PPFD] = 800.0\n\nrun!([leaf,leaf2],meteo)\n\n# You can use a Dict if you'd like to keep track of the leaf in the returned DataFrame:\nrun!(Dict(:leaf1 => leaf, :leaf2 => leaf2), meteo)\n\n# ---Using several meteo time-steps---\n\nw = Weather(\n    [\n        Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65),\n        Atmosphere(T = 25.0, Wind = 1.5, P = 101.3, Rh = 0.55)\n    ],\n    (site = \"Test site\",)\n)\n\nleaf =\n    ModelList(\n        energy_balance = Monteith(),\n        photosynthesis = Fvcb(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Rₛ = [12.0,13.747], sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n    )\n\nrun!(leaf, w)\n\n# ---Using several meteo time-steps and several components---\n\nleaf2 =\n    ModelList(\n        energy_balance = Monteith(),\n        photosynthesis = Fvcb(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Rₛ = [12.0,13.747], sky_fraction = 1.0, PPFD = 1500.0, d = 0.01)\n    )\n\nrun!(Dict(:leaf1 => leaf, :leaf2 => leaf2), w)\n\n# ---Using a model file---\n\nmodel = read_model(joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"models\",\"plant_coffee.yml\"))\n\n# An example model file is available here:\n# \"https://raw.githubusercontent.com/VEZY/PlantBiophysics/main/test/inputs/models/plant_coffee.yml\"\n\n# Initialising the mandatory variables:\ninit_status!(model, Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, Tₗ = 25.0, d = 0.03)\n\n# NB: To know which variables has to be initialized according to the models used, you can use\n# `to_initialize(ComponentModels)`, *e.g.*:\nto_initialize(model[\"Leaf\"])\n\n# Running a simulation for all component types in the same scene:\nrun!(model, meteo)\n\nmodel[\"Leaf\"].status.Rn\nmodel[\"Leaf\"].status.A\nmodel[\"Leaf\"].status.Cᵢ\n\n# ---Simulation on a full plant using an MTG---\n\nusing PlantBiophysics, MultiScaleTreeGraph, PlantGeom, GLMakie, Dates, PlantMeteo\n\nfile = joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"scene\", \"opf\", \"coffee.opf\")\nmtg = read_opf(file)\n\n# Import the meteorology:\nmet_file = joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\")\n\nmeteo = read_weather(\n    met_file,\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./ 100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)\n\n# Make the models:\nmodels = Dict(\n    \"Leaf\" =>\n        ModelList(\n            energy_balance = Monteith(),\n            photosynthesis = Fvcb(),\n            stomatal_conductance = Medlyn(0.03, 12.0),\n            status = (d = 0.03,)\n        )\n)\n\n# List the MTG attributes:\nnames(mtg)\n# We have the skyFraction already, but not Rₛ and PPFD, so we must compute them first.\n# Rₛ is the shortwave radiation (or global radiation), so it is the sum of Ra_PAR_f and Ra_NIR_f.\n# PPFD is the PAR in μmol m-2 s-1, so Ra_PAR_f * 4.57.\n\n# We can compute them using the following code (transform! comes from MultiScaleTreeGraph.jl):\ntransform!(\n    mtg,\n    [:Ra_PAR_f, :Ra_NIR_f] => ((x, y) -> x + y) => :Rₛ,\n    :Ra_PAR_f => (x -> x * 4.57) => :PPFD,\n    ignore_nothing = true\n)\n\n# We can now initialize the models in the mtg:\ninit_mtg_models!(mtg, models, length(meteo))\n\n# Making the simulation:\nrun!(mtg, meteo)\n\n# Pull the leaf temperature of the first step:\ntransform!(\n    mtg,\n    :Tₗ => (x -> x[1]) => :Tₗ_1,\n    ignore_nothing = true\n)\n\n# Vizualise the output:\nviz(mtg, color = :Tₗ_1)\n\nReferences\n\nDuursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.\n\nMonteith, John L., et Mike H. Unsworth. 2013. « Chapter 13 - Steady-State Heat Balance: (i) Water Surfaces, Soil, and Vegetation ». In Principles of Environmental Physics (Fourth Edition), edited by John L. Monteith et Mike H. Unsworth, 217‑47. Boston: Academic Press.\n\nSchymanski, Stanislaus J., et Dani Or. 2017. « Leaf-Scale Experiments Reveal an Important Omission in the Penman–Monteith Equation ». Hydrology and Earth System Sciences 21 (2): 685‑706. https://doi.org/10.5194/hess-21-685-2017.\n\nVezy, Rémi, Mathias Christina, Olivier Roupsard, Yann Nouvellon, Remko Duursma, Belinda Medlyn, Maxime Soma, et al. 2018. « Measuring and modelling energy partitioning in canopies of varying complexity using MAESPA model ». Agricultural and Forest Meteorology 253‑254 (printemps): 203‑17. https://doi.org/10.1016/j.agrformet.2018.02.005.\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.AbstractLight_InterceptionModel","page":"API","title":"PlantBiophysics.AbstractLight_InterceptionModel","text":"light_interception process abstract model. \n\nAll models implemented to simulate the light_interception process must be a subtype of this type, e.g.  struct MyLight_InterceptionModel <: AbstractLight_InterceptionModel end.\n\nYou can list all models implementing this process using subtypes:\n\nExamples\n\nsubtypes(AbstractLight_InterceptionModel)\n\nLight interception process. Available as object.light_interception.\n\nAt the moment, two models are implemented in the package:\n\nBeer: the Beer-Lambert law of ligth extinction\nLightIgnore: ignore the computation of light interception (this one is for backward\n\ncompatibility with ARCHIMED-ϕ)\n\nExamples\n\nusing PlantSimEngine, PlantBiophysics, PlantMeteo\nm = ModelList(light_interception=Beer(0.5), status=(LAI=2.0,))\n\nmeteo = Atmosphere(T=20.0, Wind=1.0, P=101.3, Rh=0.65, Ri_PAR_f=300.0)\n\nrun!(m, meteo)\n\nm[:PPFD]\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.AbstractPhotosynthesisModel","page":"API","title":"PlantBiophysics.AbstractPhotosynthesisModel","text":"photosynthesis process abstract model. \n\nAll models implemented to simulate the photosynthesis process must be a subtype of this type, e.g.  struct MyPhotosynthesisModel <: AbstractPhotosynthesisModel end.\n\nYou can list all models implementing this process using subtypes:\n\nExamples\n\nsubtypes(AbstractPhotosynthesisModel)\n\nPhotosynthesis process to compute the CO₂ assimilation, and potentially hard-coupled with a stomatal conductance process.\n\nThe models used are defined by the types of the photosynthesis and stomatal_conductance fields of the ModelList. For exemple to use the implementation of the Farquhar–von Caemmerer–Berry (FvCB) model, use the type Fvcb (see example below).\n\nExamples\n\nusing PlantSimEngine, PlantMeteo, PlantBiophysics\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\n# Using Fvcb model:\nleaf =\n    ModelList(\n        photosynthesis = Fvcb(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n    )\n\nrun!(leaf, meteo)\n\n# ---Using several components---\n\nleaf2 = copy(leaf)\nleaf2.status.PPFD = 800.0\n\nrun!([leaf,leaf2],meteo)\n\n# ---Using several meteo time-steps---\n\nw = Weather(\n        [\n            Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65),\n            Atmosphere(T = 25.0, Wind = 1.5, P = 101.3, Rh = 0.55)\n        ],\n        (site = \"Test site,)\n    )\n\nrun!(leaf, w)\n\n# ---Using several meteo time-steps and several components---\n\nrun!(Dict(:leaf1 => leaf, :leaf2 => leaf2), w)\n\n# Using a model file:\n\nmodel = read_model(\"a-model-file.yml\")\n\n# Initialising the mandatory variables:\ninit_status!(model, Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n\n# Running a simulation for all component types in the same scene:\nrun!(model, meteo)\nmodel[\"Leaf\"].status.A\n\n\nNote that we use VPD as an approximation of Dₗ here because we don't have the leaf temperature (i.e. Dₗ = VPD when Tₗ = T).\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.AbstractStomatal_ConductanceModel","page":"API","title":"PlantBiophysics.AbstractStomatal_ConductanceModel","text":"stomatal_conductance process abstract model. \n\nAll models implemented to simulate the stomatal_conductance process must be a subtype of this type, e.g.  struct MyStomatal_ConductanceModel <: AbstractStomatal_ConductanceModel end.\n\nYou can list all models implementing this process using subtypes:\n\nExamples\n\nsubtypes(AbstractStomatal_ConductanceModel)\n\nProcess for the stomatal conductance for CO₂ (mol m⁻² s⁻¹), it takes the form:\n\nleaf.stomatal_conductance.g0 + gs_closure(leaf,meteo) * leaf.status.A\n\nwhere gsclosure(leaf,meteo) computes the stomatal closure, and must be implemented for the type of `leaf.stomatalconductance. The stomatal conductance is not allowed to go belowleaf.stomatalconductance.gsmin`.\n\nArguments\n\nGs::Gsm: a stomatal conductance model, usually the leaf model (i.e. leaf.stomatal_conductance)\nmodels::ModelList: A leaf struct holding the parameters for the model. See\n\nModelList, and Medlyn or ConstantGs for the conductance models.\n\nstatus::Status: A status, usually the leaf status (i.e. leaf.status)\ngs_mod: the output from a gs_closure implementation (the conductance models\n\ngenerally only implement this function)\n\nmeteo<:PlantMeteo.AbstractAtmosphere: meteo data, see Atmosphere\n\nExamples\n\nusing PlantMeteo, PlantSimEngine, PlantBiophysics\nmeteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)\n\n# Using a constant value for Gs:\n\nleaf =\n    ModelList(\n        stomatal_conductance = Medlyn(0.03,12.0), # Instance of a Medlyn type\n        status = (A = 20.0, Cₛ = 380.0, Dₗ = meteo.VPD)\n    )\n\n# Computing the stomatal conductance using the Medlyn et al. (2011) model:\nrun!(leaf,meteo)\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Beer","page":"API","title":"PlantBiophysics.Beer","text":"Beer(k)\n\nBeer-Lambert law for light interception.\n\nRequired inputs: LAI in m² m⁻². Required meteorology data: Ri_PAR_f, the incident flux of atmospheric radiation in the PAR, in W m[soil]⁻² (== J m[soil]⁻² s⁻¹).\n\nOutput: PPFD, the absorbed Photosynthetic Photon Flux Density in μmol[PAR] m[leaf]⁻² s⁻¹.\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.ConstantA","page":"API","title":"PlantBiophysics.ConstantA","text":"Constant (forced) assimilation, given in μmol m^-2 s^-1.\n\nSee also ConstantAGs.\n\nExamples\n\nConstantA(30.0)\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.ConstantAGs","page":"API","title":"PlantBiophysics.ConstantAGs","text":"Constant (forced) assimilation, given in μmol m^-2 s^-1, coupled with a stomatal conductance model that helps computing Cᵢ.\n\nExamples\n\nConstantAGs(30.0)\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.ConstantGs","page":"API","title":"PlantBiophysics.ConstantGs","text":"Constant stomatal conductance for CO₂ struct.\n\nArguments\n\ng0: intercept (only used when calling from a photosynthesis model, e.g. Fvcb).\nGₛ: stomatal conductance.\n\nThen used as follows: Gs = ConstantGs(0.0,0.1)\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Fvcb","page":"API","title":"PlantBiophysics.Fvcb","text":"Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981) coupled with a conductance model.\n\nThe definition:\n\nTᵣ: the reference temperature (°C) at which other parameters were measured\nVcMaxRef: maximum rate of Rubisco activity (μmol m^-2 s^-1)\nJMaxRef: potential rate of electron transport (μmol m^-2 s^-1)\nRdRef: mitochondrial respiration in the light at reference temperature (μmol m^-2 s^-1)\nTPURef: triose phosphate utilization-limited photosynthesis rate (μmol m^-2 s^-1)\nEₐᵣ: activation energy (J mol^-1), or the exponential rate of rise for Rd.\nO₂: intercellular dioxygen concentration (ppm)\nEₐⱼ: activation energy (J mol^-1), or the exponential rate of rise for JMax.\nHdⱼ: rate of decrease of the function above the optimum (also called EDVJ) for JMax.\nΔₛⱼ: entropy factor for JMax.\nEₐᵥ: activation energy (J mol^-1), or the exponential rate of rise for VcMax.\nHdᵥ: rate of decrease of the function above the optimum (also called EDVC) for VcMax.\nΔₛᵥ: entropy factor for VcMax.\nα: quantum yield of electron transport (mol_e mol^-1_quanta). See also eq. 4 of\n\nMedlyn et al. (2002) and its implementation in get_J\n\nθ: determines the curvature of the light response curve for J~PPFD. See also eq. 4 of\n\nMedlyn et al. (2002) and its implementation in get_J\n\nThe default values of the temperature correction parameters are taken from plantecophys. If there is no negative effect of high temperatures on the reaction (Jmax or VcMax), then Δₛ can be set to 0.0.\n\nθ is taken at 0.7 according to (Von Caemmerer, 2000) but it can be modified to 0.9 as in (Su et al., 2009). The larger it is, the lower the smoothing.\n\nα is taken at 0.24 as in the R package plantecophys (Duursma, 2015).\n\nNote\n\nMedlyn et al. (2002) found relatively low influence (\"a slight effect\") of α and θ. They also say that Kc, Ko and Γ* \"are thought to be intrinsic properties of the Rubisco enzyme and are generally assumed constant among species\".\n\nSee also\n\nFvcbRaw for non-coupled model, directly from Farquhar et al. (1980)\nFvcbIter for the coupled assimilation / conductance model with an iterative resolution\nget_J\nAbstractPhotosynthesisModel\n\nReferences\n\nCaemmerer, S. von, et G. D. Farquhar. 1981. « Some Relationships between the Biochemistry of Photosynthesis and the Gas Exchange of Leaves ». Planta 153 (4): 376‑87. https://doi.org/10.1007/BF00384257.\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\nSu, Y., Zhu, G., Miao, Z., Feng, Q. and Chang, Z. 2009. « Estimation of parameters of a biochemically based model of photosynthesis using a genetic algorithm ». Plant, Cell & Environment, 32: 1710-1723. https://doi.org/10.1111/j.1365-3040.2009.02036.x.\n\nVon Caemmerer, Susanna. 2000. Biochemical models of leaf photosynthesis. Csiro publishing.\n\nDuursma, R. A. 2015. « Plantecophys - An R Package for Analysing and Modelling Leaf Gas Exchange Data ». PLoS ONE 10(11): e0143346. https://doi:10.1371/journal.pone.0143346.\n\nExamples\n\nGet the fieldnames:\nfieldnames(Fvcb)\n# Using default values for the model:\nA = Fvcb()\n\nA.Eₐᵥ\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.FvcbIter","page":"API","title":"PlantBiophysics.FvcbIter","text":"Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981).\n\nIterative implementation, i.e. the assimilation is computed iteratively over Cᵢ.\n\nFor more details on arguments, see Fvcb. This structure has several more parameters:\n\niter_A_max::Int: maximum number of iterations allowed for the iteration on the assimilation.\nΔT_A::T = 1: threshold bellow which the assimilation is considered constant. Given in\n\npercent of change, i.e. 1% means that two successive assimilations with less than 1% difference in value are considered the same value.\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.FvcbRaw","page":"API","title":"PlantBiophysics.FvcbRaw","text":"Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981). Direct implementation of the model.\n\nSee Fvcb for more details.\n\nSee also\n\nFvcb for the coupled assimilation / conductance model\nFvcbIter for the coupled assimilation / conductance model with an iterative resolution\nget_J\nAbstractPhotosynthesisModel\n\nReferences\n\nCaemmerer, S. von, et G. D. Farquhar. 1981. « Some Relationships between the Biochemistry of Photosynthesis and the Gas Exchange of Leaves ». Planta 153 (4): 376‑87. https://doi.org/10.1007/BF00384257.\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nExamples\n\nGet the fieldnames:\nfieldnames(FvcbRaw)\n# Using default values for the model:\nA = FvcbRaw()\n\nA.Eₐᵥ\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.LightIgnore","page":"API","title":"PlantBiophysics.LightIgnore","text":"Ignore model for light interception, see here. Make the mesh invisible, and not computed. Can save a lot of time for the computations when there are components types that are not visible anyway (e.g. inside others).\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Medlyn","page":"API","title":"PlantBiophysics.Medlyn","text":"Medlyn et al. (2011) stomatal conductance model for CO₂.\n\nArguments\n\ng0: intercept.\ng1: slope.\ngs_min = 0.001: residual conductance. We consider the residual conductance being different   from g0 because in practice g0 can be negative when fitting real-world data.\n\nExamples\n\nusing PlantMeteo, PlantSimEngine, PlantBiophysics\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf =\n    ModelList(\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (A = A, Cₛ = 380.0, Dₗ = meteo.VPD)\n    )\nrun!(leaf,meteo)\n\nNote that we use VPD as an approximation of Dₗ here because we don't have the leaf temperature (i.e. Dₗ = VPD when Tₗ = T).\n\nReferences\n\nMedlyn, Belinda E., Remko A. Duursma, Derek Eamus, David S. Ellsworth, I. Colin Prentice, Craig V. M. Barton, Kristine Y. Crous, Paolo De Angelis, Michael Freeman, et Lisa Wingate.\n\n« Reconciling the optimal and empirical approaches to modelling stomatal conductance ».\n\nGlobal Change Biology 17 (6): 2134‑44. https://doi.org/10.1111/j.1365-2486.2010.02375.x.\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Monteith","page":"API","title":"PlantBiophysics.Monteith","text":"Struct to hold parameter and values for the energy model close to the one in Monteith and Unsworth (2013)\n\nArguments\n\naₛₕ = 2: number of faces of the object that exchange sensible heat fluxes\naₛᵥ = 1: number of faces of the object that exchange latent heat fluxes (hypostomatous => 1)\nε = 0.955: emissivity of the object\nmaxiter = 10: maximal number of iterations allowed to close the energy balance\nΔT = 0.01 (°C): maximum difference in object temperature between two iterations to consider convergence\n\nExamples\n\nenergy_model = Monteith() # a leaf in an illuminated chamber\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.OpticalProperties","page":"API","title":"PlantBiophysics.OpticalProperties","text":"Optical properties abstract struct\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Translucent","page":"API","title":"PlantBiophysics.Translucent","text":"Translucent model for light interception, see here.\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.σ","page":"API","title":"PlantBiophysics.σ","text":"σ()\n\nσ, the scattering factor of a component. See here for more details\n\n\n\n\n\n","category":"type"},{"location":"functions/#PlantBiophysics.Fvcb_net_assimiliation-NTuple{6, Any}","page":"API","title":"PlantBiophysics.Fvcb_net_assimiliation","text":"Fvcb_net_assimiliation(Cᵢ,Vⱼ,Γˢ,VcMax,Km,Rd)\n\nNet assimilation following the Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.arrhenius","page":"API","title":"PlantBiophysics.arrhenius","text":"arrhenius(A,Eₐ,Tₖ,Tᵣₖ,R = PlantMeteo.Constants().R)\n\nThe Arrhenius function for dependence of the rate constant of a chemical reaction.\n\nArguments\n\nA: pre-exponential factor, a constant for each chemical reaction\nEₐ: activation energy for the reaction (J mol^-1)\nTₖ: temperature (Kelvin)\nTᵣₖ: reference temperature (Kelvin) at which A was measured\nR: universal gas constant (J mol^-1 K^-1)\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\n# Importing physical constants\nconstants = PlantMeteo.Constants()\n# Using default values for the model:\nA = Fvcb()\n\n# Computing Jmax:\narrhenius(A.JMaxRef,A.Eₐⱼ,28.0-constants.K₀,A.Tᵣ-constants.K₀,constants.R)\n# ! Warning: temperatures must be given in Kelvin\n\n# Computing Vcmax:\narrhenius(A.VcMaxRef,A.Eₐᵥ,28.0-constants.K₀,A.Tᵣ-constants.K₀,constants.R)\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.arrhenius-2","page":"API","title":"PlantBiophysics.arrhenius","text":"arrhenius(A,Eₐ,Tₖ,Tᵣₖ,Hd,Δₛ,R = Constants().R)\n\nThe Arrhenius function for dependence of the rate constant of a chemical reaction, modified following equation (17) from Medlyn et al. (2002) to consider the negative effect of very high temperatures.\n\nArguments\n\nA: the pre-exponential factor, a constant for each chemical reaction\nEₐ: activation energy (J mol^-1), or the exponential rate of rise\n\nof the function (Ha in the equation of Medlyn et al. (2002))\n\nTₖ: current temperature (Kelvin)\nTᵣₖ: reference temperature (Kelvin) at which A was measured\nHd: rate of decrease of the function above the optimum (called EDVJ in\n\nMAESPA and plantecophys)\n\nΔₛ: entropy factor\nR: is the universal gas constant (J mol^-1 K^-1)\n\nReferences\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\n# Importing physical constants\nconstants = Constants()\n# Using default values for the model:\nA = Fvcb()\n\n# Computing Jmax:\nPlantBiophysics.arrhenius(A.JMaxRef,A.Eₐⱼ,28.0-constants.K₀,A.Tᵣ-constants.K₀,A.Hdⱼ,A.Δₛⱼ)\n# ! Warning: temperatures must be given in Kelvin\n\n# Computing Vcmax:\nPlantBiophysics.arrhenius(A.VcMaxRef,A.Eₐᵥ,28.0-constants.K₀,A.Tᵣ-constants.K₀,A.Hdᵥ,A.Δₛᵥ)\n\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.black_body-Tuple{Any, Any, Any}","page":"API","title":"PlantBiophysics.black_body","text":"black_body(T, K₀, σ)\nblack_body(T)\n\nThermal infrared, i.e. longwave radiation emitted from a black body at temperature T.\n\nT: temperature of the object in Celsius degree\nK₀: absolute zero (°C)\nσ (W m^-2 K^-4) Stefan-Boltzmann constant\n\nNote\n\nK₀ and σ are taken from PlantMeteo.Constants if not provided.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.gbh_to_gbw","page":"API","title":"PlantBiophysics.gbh_to_gbw","text":"gbh_to_gbw(gbh, Gbₕ_to_Gbₕ₂ₒ = PlantMeteo.Constants().Gbₕ_to_Gbₕ₂ₒ)\ngbw_to_gbh(gbh, Gbₕ_to_Gbₕ₂ₒ = PlantMeteo.Constants().Gbₕ_to_Gbₕ₂ₒ)\n\nBoundary layer conductance for water vapor from boundary layer conductance for heat.\n\nArguments\n\ngbh (m s-1): boundary layer conductance for heat under mixed convection.\nGbₕ_to_Gbₕ₂ₒ: conversion factor.\n\nNote\n\nGbₕ is the sum of free and forced convection. See gbₕ_free and gbₕ_forced.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.gbₕ_forced-Tuple{Any, Any}","page":"API","title":"PlantBiophysics.gbₕ_forced","text":"gbₕ_forced(Wind,d)\n\nBoundary layer conductance for heat under forced convection (m s-1). See eq. E1 from Leuning et al. (1995) for more details.\n\nArguments\n\nWind (m s-1): wind speed\nd (m): characteristic dimension, e.g. leaf width (see eq. 10.9 from Monteith and Unsworth, 2013).\n\nNotes\n\nd is the minimal dimension of the surface of an object in contact with the air.\n\nReferences\n\nLeuning, R., F. M. Kelliher, DGG de Pury, et E.-D. SCHULZE. 1995. « Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.gbₕ_free","page":"API","title":"PlantBiophysics.gbₕ_free","text":"gbₕ_free(Tₐ,Tₗ,d,Dₕ₀)\ngbₕ_free(Tₐ,Tₗ,d)\n\nLeaf boundary layer conductance for heat under free convection (m s-1).\n\nArguments\n\nTₐ (°C): air temperature\nTₗ (°C): leaf temperature\nd (m): characteristic dimension, e.g. leaf width (see eq. 10.9 from Monteith and Unsworth, 2013).\nDₕ₀ = 21.5e-6: molecular diffusivity for heat at base temperature. Use value from\n\nPlantMeteo.Constants if not provided.\n\nNote\n\nR and Dₕ₀ can be found using PlantMeteo.Constants. To transform in mol m^-2 s^-1, use ms_to_mol.\n\nReferences\n\nLeuning, R., F. M. Kelliher, DGG de Pury, et E.-D. SCHULZE. 1995. « Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.\n\nMonteith, John, et Mike Unsworth. 2013. Principles of environmental physics: plants, animals, and the atmosphere. Academic Press. Paragraph 10.1.3, eq. 10.9.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.get_Cᵢᵥ-NTuple{7, Any}","page":"API","title":"PlantBiophysics.get_Cᵢᵥ","text":"Analytic resolution of Cᵢ when the RuBisCo activity is limiting (μmol mol^-1)\n\nArguments\n\nVcMAX: maximum rate of RuBisCo activity(μmol m^-2 s^-1)\nΓˢ: CO2 compensation point Γ^ (μmol mol^-1)\nCₛ: stomatal CO₂ concentration (μmol mol^-1)\nRd: day respiration (μmol m^-2 s^-1)\ng0: residual stomatal conductance (μmol m^-2 s^-1)\nst_closure: stomatal conductance term computed from a given implementation of a Gs model,\n\ne.g. Medlyn.\n\nKm: effective Michaelis–Menten coefficient for CO2 (μ mol mol^-1)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.get_Cᵢⱼ-NTuple{6, Any}","page":"API","title":"PlantBiophysics.get_Cᵢⱼ","text":"Analytic resolution of Cᵢ when the rate of electron transport is limiting (μmol mol^-1)\n\nArguments\n\nVⱼ: RuBP regeneration (J/4.0, μmol m^-2 s^-1)\nΓˢ: CO2 compensation point Γ^ (μmol mol^-1)\nCₛ: stomatal CO₂ concentration (μmol mol^-1)\nRd: day respiration (μmol m^-2 s^-1)\ng0: residual stomatal conductance (μmol m^-2 s^-1)\nst_closure: stomatal conductance term computed from a given implementation of a Gs model,\n\ne.g. Medlyn.\n\nReferences\n\nDuursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.\n\nWang and Leuning, 1998\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.get_Dₕ","page":"API","title":"PlantBiophysics.get_Dₕ","text":"get_Dₕ(T,Dₕ₀)\nget_Dₕ(T)\n\nDₕ -molecular diffusivity for heat at base temperature- from Dₕ₀ (corrected by temperature). See Monteith and Unsworth (2013, eq. 3.10).\n\nArguments\n\nTₐ (°C): temperature\nDₕ₀: molecular diffusivity for heat at base temperature. Use value from PlantMeteo.Constants\n\nif not provided.\n\nReferences\n\nMonteith, John, et Mike Unsworth. 2013. Principles of environmental physics: plants, animals, and the atmosphere. Academic Press. Paragraph 10.1.3.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.get_J-NTuple{4, Any}","page":"API","title":"PlantBiophysics.get_J","text":"Rate of electron transport J (μmol m^-2 s^-1), computed using the smaller root of the quadratic equation (eq. 4 from Medlyn et al., 2002):\n\nθ * J² - (α * PPFD + JMax) * J + α * PPFD * JMax\n\nNB: we use the smaller root because considering the range of values for θ and α (quite stable), and PPFD and JMax, the function always tends to JMax with high PPFD with the smaller root (behavior we are searching), and the opposite with the larger root.\n\nReturns\n\nA tuple with (A, Gₛ, Cᵢ):\n\nA: carbon assimilation (μmol m-2 s-1)\nGₛ: stomatal conductance (mol m-2 s-1)\nCᵢ: intercellular CO₂ concentration (ppm)\n\nArguments\n\nPPFD: absorbed photon irradiance (μmol_quanta m^-2 s^-1)\nα: quantum yield of electron transport (mol_e mol^-1_quanta)\nJMax: maximum rate of electron transport (μmol m^-2 s^-1)\nθ: determines the shape of the non-rectangular hyperbola (-)\n\nReferences\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\nVon Caemmerer, Susanna. 2000. Biochemical models of leaf photosynthesis. Csiro publishing.\n\nExamples\n\n# Using default values for the model:\njulia> A = Fvcb()\nFvcb{Float64}(25.0, 200.0, 250.0, 0.6, 9999.0, 46390.0, 210.0, 29680.0, 200000.0, 631.88, 58550.0, 200000.0, 629.26, 0.24, 0.7)\n\njulia> PlantBiophysics.get_J(1500, A.JMaxRef, A.α, A.θ)\n188.17537926909347\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.get_km","page":"API","title":"PlantBiophysics.get_km","text":"Compute the effective Michaelis–Menten coefficient for CO2 Km (μ mol mol^-1) according to Medlyn et al. (2002), equations (5) and (6).\n\nReferences\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\nExamples\n\n# computing the temperature dependence of γˢ:\nget_km(28,25,210.0)\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.get_model-Tuple{Any, Any}","page":"API","title":"PlantBiophysics.get_model","text":"get_model(x)\n\nReturn the model (the actual struct) given its name passed as a String.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.get_process-Tuple{Any}","page":"API","title":"PlantBiophysics.get_process","text":"get_process(x)\n\nReturn the process type (the actual struct) given its name passed as a String.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.grey_body-NTuple{4, Any}","page":"API","title":"PlantBiophysics.grey_body","text":"Thermal infrared, i.e. longwave radiation emitted from an object at temperature T.\n\nT: temperature of the object in Celsius degree\nε object emissivity (not to confuse with ε the\n\nratio of molecular weights from PlantMeteo.Constants). A typical value for a leaf is 0.955.\n\nK₀: absolute zero (°C)\nσ (W m^-2 K^-4) Stefan-Boltzmann constant\n\nNote\n\nK₀ and σ are taken from PlantMeteo.Constants if not provided.\n\nExamples\n\n# Thermal infrared radiation of water at 25 °C:\ngrey_body(25.0, 0.96)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.gs_closure","page":"API","title":"PlantBiophysics.gs_closure","text":"Constant stomatal closure. Usually called from a photosynthesis model.\n\nNote\n\nmeteo is just declared here for compatibility with other formats of calls.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.gs_closure-2","page":"API","title":"PlantBiophysics.gs_closure","text":"gs_closure(leaf::ModelList,meteo)\n\nStomatal closure for CO₂ according to Medlyn et al. (2011). Carefull, this is just a part of the computation of the stomatal conductance.\n\nThe result of this function is then used as:\n\ngs_mod = gs_closure(leaf,meteo)\n\n# And then stomatal conductance (μmol m-2 s-1) calling [`stomatal_conductance`](@ref):\nGₛ = leaf.stomatal_conductance.g0 + gs_mod * leaf.status.A\n\nArguments\n\n::Medlyn: a medlyn model, usually the leaf model (i.e. leaf.stomatal_conductance)\nleaf::ModelList: A ModelList struct holding the parameters for\n\nthe model.\n\nstatus: A status, usually the leaf status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere. Is not used in this model.\n\nDetails\n\nUse variables() on Medlyn to get the variables that must be instantiated in the ModelList struct.\n\nNotes\n\nCₛ is used instead of Cₐ because Gₛ is between the surface and the intercellular space. The conductance\n\nbetween the atmosphere and the surface is accounted for using the boundary layer conductance (Gbc in Monteith). Medlyn et al. (2011) uses Cₐ in their paper because they relate their models to the measurements made at leaf level, with a well-mixed chamber whereCₛ ≈ Cₐ.\n\nDₗ is forced to be >= 1e-9 because it is used in a squared root. It is prefectly acceptable to\n\nget a negative Dₗ when leaves are re-hydrating from air. Cloud forests are the perfect example. See e.g.: Guzmán‐Delgado, P, Laca, E, Zwieniecki, MA. Unravelling foliar water uptake pathways: The contribution of stomata and the cuticle. Plant Cell Environ. 2021; 1– 13. https://doi.org/10.1111/pce.14041\n\nExamples\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf =\n    ModelList(\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Cₛ = 380.0, Dₗ = meteo.VPD)\n    )\n\ngs_mod = gs_closure(leaf, meteo)\n\nA = 20 # example assimilation (μmol m-2 s-1)\nGs = leaf.stomatal_conductance.g0 + gs_mod * A\n\n# Or more directly using `run!()`:\n\nleaf =\n    ModelList(\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (A = A, Cₛ = 380.0, Dₗ = meteo.VPD)\n    )\nrun!(leaf,meteo)\n\nNote that we use VPD as an approximation of Dₗ here because we don't have the leaf temperature (i.e. Dₗ = VPD when Tₗ = T).\n\nReferences\n\nMedlyn, Belinda E., Remko A. Duursma, Derek Eamus, David S. Ellsworth, I. Colin Prentice, Craig V. M. Barton, Kristine Y. Crous, Paolo De Angelis, Michael Freeman, et Lisa Wingate.\n\n« Reconciling the optimal and empirical approaches to modelling stomatal conductance ».\n\nGlobal Change Biology 17 (6): 2134‑44. https://doi.org/10.1111/j.1365-2486.2010.02375.x.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.gsc_to_gsw","page":"API","title":"PlantBiophysics.gsc_to_gsw","text":"gsc_to_gsw(Gₛ, Gsc_to_Gsw = PlantMeteo.Constants().Gsc_to_Gsw)\n\nConversion of a stomatal conductance for CO₂ into stomatal conductance for H₂O.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.gsw_to_gsc","page":"API","title":"PlantBiophysics.gsw_to_gsc","text":"gsw_to_gsc(Gₛ, Gsc_to_Gsw = PlantMeteo.Constants().Gsc_to_Gsw)\n\nConversion of a stomatal conductance for H₂O into stomatal conductance for CO₂.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantBiophysics.instantiate-NTuple{4, Any}","page":"API","title":"PlantBiophysics.instantiate","text":"instantiate(x)\n\nInstantiate a model given its parameter names, considering that parameter names can be different compared to the model fields (used to insure compatibility with Archimed).\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.is_model-Tuple{Any}","page":"API","title":"PlantBiophysics.is_model","text":"is_model(model)\n\nCheck if a model object has the\"Group\" and \"Type\" keys as the first level of a Dict type object. But the function is generic as long as the input struct has a keys() method.\n\nExamples\n\nmodels = read_model(\"path_to_a_model_file.yaml\")\nis_model(models)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.latent_heat-NTuple{8, Any}","page":"API","title":"PlantBiophysics.latent_heat","text":"latent_heat(Rn, VPD, γˢ, Rbₕ, Δ, ρ, aₛₕ, Cₚ)\nlatent_heat(Rn, VPD, γˢ, Rbₕ, Δ, ρ, aₛₕ)\n\nλE -the latent heat flux (W m-2)- using the Monteith and Unsworth (2013) definition corrected by Schymanski et al. (2017), eq.22.\n\nRn (W m-2): net radiation. Carefull: not the isothermal net radiation\nVPD (kPa): air vapor pressure deficit\nγˢ (kPa K−1): apparent value of psychrometer constant (see PlantMeteo.γ_star)\nRbₕ (s m-1): resistance for heat transfer by convection, i.e. resistance to sensible heat\nΔ (KPa K-1): rate of change of saturation vapor pressure with temperature (see PlantMeteo.e_sat_slope)\nρ (kg m-3): air density of moist air.\naₛₕ (1,2): number of sides that exchange energy for heat (2 for leaves)\nCₚ (J K-1 kg-1): specific heat of air for constant pressure\n\nReferences\n\nMonteith, J. and Unsworth, M., 2013. Principles of environmental physics: plants, animals, and the atmosphere. Academic Press. See eq. 13.33.\n\nSchymanski et al. (2017), Leaf-scale experiments reveal an important omission in the Penman–Monteith equation, Hydrology and Earth System Sciences. DOI: https://doi.org/10.5194/hess-21-685-2017. See equ. 22.\n\nExamples\n\nTₐ = 20.0 ; P = 100.0 ;\nρ = air_density(Tₐ, P) # in kg m-3\nΔ = e_sat_slope(Tₐ)\n\nlatent_heat(300.0, 2.0, 0.1461683, 50.0, Δ, ρ, 2.0)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.mol_to_ms-NTuple{5, Any}","page":"API","title":"PlantBiophysics.mol_to_ms","text":"ms_to_mol(G,T,P,R,K₀)\nms_to_mol(G,T,P)\n\nConversion of a conductance G from mol m^-2 s^-1 to m s^-1.\n\nArguments\n\nG (m s^-1): conductance\nT (°C): air temperature\nP (kPa): air pressure\nR (J mol^-1 K^-1): universal gas constant.\nK₀ (°C): absolute zero\n\nSee also\n\nms_to_mol for the inverse process.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.ms_to_mol-NTuple{5, Any}","page":"API","title":"PlantBiophysics.ms_to_mol","text":"ms_to_mol(G,T,P,R,K₀)\nms_to_mol(G,T,P)\n\nConversion of a conductance G from m s^-1 to mol m^-2 s^-1.\n\nArguments\n\nG (m s^-1): conductance\nT (°C): air temperature\nP (kPa): air pressure\nR (J mol^-1 K^-1): universal gas constant.\nK₀ (°C): absolute zero\n\nSee also\n\nmol_to_ms for the inverse process.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.net_longwave_radiation-NTuple{7, Any}","page":"API","title":"PlantBiophysics.net_longwave_radiation","text":"net_longwave_radiation(T₁,T₂,ε₁,ε₂,F₁,K₀,σ)\nnet_longwave_radiation(T₁,T₂,ε₁,ε₂,F₁)\n\nNet longwave radiation fluxes (i.e. thermal radiation, W m-2) between an object and another. The object of interest is at temperature T₁ and has an emissivity ε₁, and the object with which it exchanges energy is at temperature T₂ and has an emissivity ε₂.\n\nIf the result is positive, then the object of interest gain energy.\n\nArguments\n\nT₁ (Celsius degree): temperature of the target object (object 1)\nT₂ (Celsius degree): temperature of the object with which there is potential exchange (object 2)\nε₁: object 1 emissivity\nε₂: object 2 emissivity\nF₁: view factor (0-1), i.e. visible fraction of object 2 from object 1 (see note)\nK₀: absolute zero (°C)\nσ (W m^-2 K^-4) Stefan-Boltzmann constant\n\nNote\n\nF₁, the view factor (also called shape factor) is a coefficient applied to the semi-hemisphere field of view of object 1 that \"sees\" object 2. E.g. a leaf can be viewed as a plane. If one side of the leaf sees only object 2 in its field of view (e.g. the sky), then F₁ = 1. Then the net longwave radiation flux for this part of the leaf is multiplied by its actual surface to get the exchange. Note that we apply reciprocity between the two objects for the view factor (they have the same value), i.e.: A₁F₁₂ = A₂F₂₁.\n\nThen, if we take a leaf as object 1, and the sky as object 2, the visible fraction of sky viewed by the leaf would be:\n\n0.5 if the leaf is on top of the canopy, i.e. the upper side of the leaf sees the sky,\n\nthe side bellow sees other leaves and the soil.\n\nbetween 0 and 0.5 if it is within the canopy and partly shaded by other objects.\n\nNote that A₁ for a leaf is twice its common used leaf area, because A₁ is the total leaf area of the object that exchange energy.\n\n# Net thermal radiation fluxes between a leaf and the sky considering the leaf at the top of\n# the canopy:\nTₗ = 25.0 ; Tₐ = 20.0\nε₁ = 0.955 ; ε₂ = 1.0\nRₗₗ = net_longwave_radiation(Tₗ,Tₐ,ε₁,ε₂,1.0)\nRₗₗ\n\n# Rₗₗ is the net longwave radiation flux between the leaf and the atmosphere per surface area.\n# To get the actual net longwave radiation flux we need to multiply by the surface of the\n# leaf, e.g. for a leaf of 2cm²:\nleaf_area = 2e-4 # in m²\nRₗₗ * leaf_area\n\n# The leaf lose ~0.0055 W towards the atmosphere.\n\nReferences\n\nCengel, Y, et Transfer Mass Heat. 2003. A practical approach. New York, NY, USA: McGraw-Hill.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.read_licor6400-Tuple{Any}","page":"API","title":"PlantBiophysics.read_licor6400","text":"read_licor6400(file)\n\nImport Licor6400 data (such as Medlyn 2001 data) with the units and names corresponding to the ones used in PlantBiophysics.jl.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.read_model-Tuple{Any}","page":"API","title":"PlantBiophysics.read_model","text":"read_model(file)\n\nRead a model file. The model file holds the choice and the parameterization of the models.\n\nArguments\n\nfile::String: path to a model file\n\nExamples\n\nfile = joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"models\", \"plant_coffee.yml\")\nmodels = read_model(file)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.read_walz-Tuple{Any}","page":"API","title":"PlantBiophysics.read_walz","text":"read_walz(file)\n\nImport a Walz GFS-3000 output file, perform variables conversion and rename according to package conventions.\n\nArguments\n\nfile: a string or a vector of strings containing the path to the file(s) to read.\n\nExamples\n\nReading one file:\n\nfile = joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\",\"P1F20129.csv\")\nread_walz(file)\n\nWe can also read multiple files at once:\n\nfiles = readdir(joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\"), join = true)\ndf = read_walz(files)\n\nIn this case, the source of the data is added as the source columns into the DataFrame:\n\ndf.source\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.sensible_heat-NTuple{8, Any}","page":"API","title":"PlantBiophysics.sensible_heat","text":"sensible_heat(Rn, VPD, γˢ, Rbₕ, Δ, ρ, aₛₕ, Cₚ)\nsensible_heat(Rn, VPD, γˢ, Rbₕ, Δ, ρ, aₛₕ)\n\nH -the sensible heat flux (W m-2)- using the Monteith and Unsworth (2013) definition corrected by Schymanski et al. (2017), eq.22.\n\nRn (W m-2): net radiation. Carefull: not the isothermal net radiation\nVPD (kPa): air vapor pressure deficit\nγˢ (kPa K−1): apparent value of psychrometer constant (see PlantMeteo.γ_star)\nRbₕ (s m-1): resistance for heat transfer by convection, i.e. resistance to sensible heat\nΔ (KPa K-1): rate of change of saturation vapor pressure with temperature (see PlantMeteo.e_sat_slope)\nρ (kg m-3): air density of moist air.\naₛₕ (1,2): number of sides that exchange energy for heat (2 for leaves)\nCₚ (J K-1 kg-1): specific heat of air for constant pressure\n\nReferences\n\nMonteith, J. and Unsworth, M., 2013. Principles of environmental physics: plants, animals, and the atmosphere. Academic Press. See eq. 13.33.\n\nSchymanski et al. (2017), Leaf-scale experiments reveal an important omission in the Penman–Monteith equation, Hydrology and Earth System Sciences. DOI: https://doi.org/10.5194/hess-21-685-2017. See equ. 22.\n\nExamples\n\nTₐ = 20.0 ; P = 100.0 ;\nρ = air_density(Tₐ, P) # in kg m-3\nΔ = PlantMeteo.e_sat_slope(Tₐ)\n\nsensible_heat(300.0, 2.0, 0.1461683, 50.0, Δ, ρ, 2.0)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.Γ_star","page":"API","title":"PlantBiophysics.Γ_star","text":"Γ_star(Tₖ,Tᵣₖ,R = PlantMeteo.Constants().R)\n\nCO₂ compensation point Γ^ (μ mol mol^-1) according to equation (12) from Medlyn et al. (2002).\n\nΓ^ is the [CO₂] at which oxygenation proceeds at\n\ntwice the rate of carboxylation causing photosynthetic uptake of CO2 to be exactly compensated by photorespiratory CO₂ release (Sharkey et al., 2007).\n\nNotes\n\nCould be replaced by equation (38) from Farquhar et al. (1980), but Medlyn et al. (2002) states that Γ^ as a relatively low effect on the model outputs.\n\nArguments\n\nTₖ (Kelvin): current temperature\nTᵣₖ (Kelvin): reference temperature at which A was measured\nR (J mol^-1 K^-1): is the universal gas constant\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\n# Importing the physical constants:\nconstants = Constants()\n# computing the temperature dependence of γˢ:\nΓ_star(28-constants.K₀,25-constants.K₀,constants.R)\n\nReferences\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nMedlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.\n\nSharkey, Thomas D., Carl J. Bernacchi, Graham D. Farquhar, et Eric L. Singsaas. 2007. « Fitting Photosynthetic Carbon Dioxide Response Curves for C3 Leaves ». Plant, Cell & Environment 30 (9): 1035‑40. https://doi.org/10.1111/j.1365-3040.2007.01710.x.\n\n\n\n\n\n","category":"function"},{"location":"functions/#Un-exported-functions","page":"API","title":"Un-exported functions","text":"","category":"section"},{"location":"functions/","page":"API","title":"API","text":"Modules = [PlantBiophysics]\nPublic = false","category":"page"},{"location":"functions/#PlantBiophysics.f_ms_to_mol-NTuple{4, Any}","page":"API","title":"PlantBiophysics.f_ms_to_mol","text":"Conversion factor between conductance in m s^-1 to mol m^-2 s^-1.\n\nArguments\n\nT (°C): air temperature\nP (kPa): air pressure\nR (J mol^-1 K^-1): universal gas constant.\nK₀ (°C): absolute zero\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.locf!-Tuple{Any}","page":"API","title":"PlantBiophysics.locf!","text":"locf!(var)\n\nLast observation carried forward (LOCF) iterates forwards var and fills missing data with the last existing observation.\n\nThis function is heavily inspired (i.e. copied) by the function locf in the package Impute (MIT licence). See here for more details.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.max_root-Tuple{Any, Any, Any}","page":"API","title":"PlantBiophysics.max_root","text":"Maximum value between two roots of a quadratic equation.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.negative_root-Tuple{Any, Any, Any}","page":"API","title":"PlantBiophysics.negative_root","text":"Negative root of a quadratic equation, but returns 0 if Δ is negative. Careful, this is not right mathematically, but biologically OK because used in the computation of Cᵢ (gives A = 0 in this case).\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.positive_root-Tuple{Any, Any, Any}","page":"API","title":"PlantBiophysics.positive_root","text":"Positive root of a quadratic equation, but returns 0 if Δ is negative. Careful, this is not right mathematically, but biologically OK because used in the computation of Cᵢ (gives A = 0 in this case).\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.γ_star-NTuple{6, Any}","page":"API","title":"PlantBiophysics.γ_star","text":"γstar(γ, ash, a_s, rbv, Rsᵥ, Rbₕ)\n\nγ∗, the apparent value of psychrometer constant (kPa K−1).\n\nArguments\n\nγ (kPa K−1): psychrometer constant\naₛₕ (1,2): number of faces exchanging heat fluxes (see Schymanski et al., 2017)\naₛᵥ (1,2): number of faces exchanging water fluxes (see Schymanski et al., 2017)\nRbᵥ (s m-1): boundary layer resistance to water vapor\nRsᵥ (s m-1): stomatal resistance to water vapor\nRbₕ (s m-1): boundary layer resistance to heat\n\nNote\n\nUsing the corrigendum from Schymanski et al. (2017) in here so the definition of latent_heat remains generic.\n\nNot to be confused with Γ_star the CO₂ compensation point.\n\nReferences\n\nMonteith, John L., et Mike H. Unsworth. 2013. « Chapter 13 - Steady-State Heat Balance: (i) Water Surfaces, Soil, and Vegetation ». In Principles of Environmental Physics (Fourth Edition), edited by John L. Monteith et Mike H. Unsworth, 217‑47. Boston: Academic Press.\n\nSchymanski, Stanislaus J., et Dani Or. 2017. Leaf-Scale Experiments Reveal an Important Omission in the Penman–Monteith Equation ». Hydrology and Earth System Sciences 21 (2): 685‑706. https://doi.org/10.5194/hess-21-685-2017.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantBiophysics.λE_to_E","page":"API","title":"PlantBiophysics.λE_to_E","text":"λE_to_E(λE, λ, Mₕ₂ₒ=PlantMeteo.Constants().Mₕ₂ₒ)\nE_to_λE(E, λ, Mₕ₂ₒ=PlantMeteo.Constants().Mₕ₂ₒ)\n\nConversion from latent heat (W m-2) to evaporation (mol[H₂O] m-2 s-1) or the opposite (E_to_λE).\n\nArguments\n\nλE: latent heat flux (W m-2)\nE: water evaporation (mol[H₂O] m-2 s-1)\nλ (J kg-1): latent heat of vaporization\nMₕ₂ₒ = 18.0e-3 (kg mol-1): Molar mass for water.\n\nNote\n\nλ can be computed using:\n\nλ = latent_heat_vaporization(T, constants.λ₀)\n\nIt is also directly available from the Atmosphere structure, and by extention in Weather.\n\nTo convert E from mol[H₂O] m-2 s-1 to mm s-1 you can simply do:\n\nE_mms = E_mol / constants.Mₕ₂ₒ\n\nmm[H₂O] s-1 is equivalent to kg[H₂O] m-2 s-1, wich is equivalent to l[H₂O] m-2 s-1.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.fit-Tuple{Type{Beer}, Any}","page":"API","title":"PlantSimEngine.fit","text":"fit(::Type{Beer}, df; J_to_umol=PlantMeteo.Constants().J_to_umol)\n\nOptimize k, the coefficient of the Beer-Lambert law of light extinction.\n\nArguments\n\ndf: a DataFrame with columns RiPARf (Incoming light flux in the PAR, W m⁻²), \n\nPPFD (μmol m⁻² s⁻¹) and LAI (m² m⁻²), where each row is an observation. The column names should match exactly.\n\nExamples\n\nusing PlantSimEngine, PlantBiophysics, DataFrames, PlantMeteo\n\n# Defining dummy data:\ndf = DataFrame(\n    Ri_PAR_f = [200.0, 250.0, 300.0], \n    PPFD = [548.4, 685.5, 822.6], \n    LAI = [1.0, 1.0, 1.0],\n    T = [20.0, 20.0, 20.0],\n    Rh = [0.5, 0.5, 0.5],\n    Wind = [10.0, 10.0, 10.0],\n)\n\n# Fit the parameters values:\nk = fit(Beer, df)\n\n# Re-simulating PPFD using the newly fitted parameters:\nw = Weather(df)\nleaf = ModelList(\n        Beer(k.k),\n        status = (LAI = df.LAI,)\n    )\nrun!(leaf, w)\n\nleaf\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantSimEngine.fit-Union{Tuple{T}, Tuple{T, Any}} where T<:Type{Medlyn}","page":"API","title":"PlantSimEngine.fit","text":"fit(::Type{Medlyn}, df)\n\nOptimize the parameters of the Medlyn model. Note that here Gₛ is stomatal conductance for CO2, not H2O.\n\nArguments\n\ndf: a DataFrame with columns A, Dₗ, Cₐ and Gₛ, where each row is an observation. The column\n\nnames should match exactly.\n\nNote that Dₗ is the leaf to air vapour pressure deficit, computed as follows:\n\nDₗ = PlantMeteo.e_sat(Tₗ) - PlantMeteo.e_sat(T) * Rh\n\nwith Tₗ the leaf temperature, T the air temperature and Rh the air relative humidity. If Tₗ is not available, you can use Tₗ = T as a crude approximation, which gives Dₗ = VPD.\n\nExamples\n\nusing PlantBiophysics, PlantMeteo, Plots, DataFrames\n\nfile = joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\",\"P1F20129.csv\")\ndf = read_walz(file)\n# Removing the CO2 and ligth Curve, we fit the parameters on the Rh curve:\nfilter!(x -> x.curve != \"ligth Curve\" && x.curve != \"CO2 Curve\", df)\n\n# Fit the parameters values:\ng0, g1 = fit(Medlyn, df)\n\n# Re-simulating Gₛ using the newly fitted parameters:\nw = Weather(select(df, :T, :P, :Rh, :Cₐ, :VPD, :T => (x -> 10) => :Wind))\nleaf = ModelList(\n        stomatal_conductance = Medlyn(g0, g1),\n        status = (A = df.A, Cₛ = df.Cₐ, Dₗ = df.Dₗ)\n    )\nrun!(leaf, w)\n\n# Visualising the results:\ngsAvpd = PlantBiophysics.GsADₗ(g0, g1, df.Gₛ, df.Dₗ, df.A, df.Cₐ, leaf[:Gₛ])\nplot(gsAvpd,leg=:bottomright)\n# As in [`Medlyn`](@ref) reference paper, linear regression is also plotted.\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantSimEngine.fit-Union{Tuple{T}, Tuple{T, Any}} where T<:Union{Type{Fvcb}, Type{FvcbIter}, Type{FvcbRaw}}","page":"API","title":"PlantSimEngine.fit","text":"fit(\n    ::Type{Fvcb}, df; \n    Tᵣ = nothing, \n    VcMaxRef = 0.0, JMaxRef = 0.0, RdRef = 0.0, TPURef = 0.0, \n    VcMaxRef_bound=[0.0, Inf], JMaxRef_bound=[0.0, Inf], RdRef_bound=[0.0, Inf], TPURef_bound=[0.0, Inf],\n    verbose = true\n)\n\nOptimize the parameters of the Fvcb model. Also works for FvcbIter.\n\nArguments\n\ndf: a DataFrame with columns A, PPFD, Tₗ and Cᵢ, where each row is an observation. The column\n\nnames should match exactly\n\nTᵣ: reference temperature for the optimized parameter values. If not provided, use the average Tₗ.\nVcMaxRef, JMaxRef, RdRef, TPURef: initialisation values for the parameter optimisation\nVcMaxRefbound, JMaxRefbound, RdRefbound, TPURefbound: boundary values for the parameter optimisation\nverbose: if true, print the optimisation results\n\nNote that boundary values are set to [0.0, Inf] by default. You should adapt them to your use case. Note that no  boundary can be set using [-Inf, Inf].\n\nExamples\n\nusing PlantBiophysics, PlantMeteo, Plots, DataFrames\n\nfile = joinpath(dirname(dirname(pathof(PlantBiophysics))),\"test\",\"inputs\",\"data\",\"P1F20129.csv\")\ndf = read_walz(file)\n# Removing the Rh and light curves for the fitting because temperature varies\nfilter!(x -> x.curve != \"Rh Curve\" && x.curve != \"ligth Curve\", df)\n\n# Fit the parameter values:\nVcMaxRef, JMaxRef, RdRef, TPURef = fit(Fvcb, df; Tᵣ = 25.0)\n# Note that Tᵣ was set to 25 °C in our response curve. You should adapt its value to what you\n# had during the response curves\n\n# Checking the results:\nfilter!(x -> x.curve == \"CO2 Curve\", df)\n\n# Sort the DataFrame by :Cᵢ to get ordered data point\nsort!(df, :Cᵢ)\n\n# Re-simulating A using the newly fitted parameters:\nleaf =\n    ModelList(\n        photosynthesis = FvcbRaw(VcMaxRef = VcMaxRef, JMaxRef = JMaxRef, RdRef = RdRef, TPURef = TPURef),\n        status = (Tₗ = df.Tₗ, PPFD = df.PPFD, Cᵢ = df.Cᵢ)\n    )\nrun!(leaf)\ndf_sim = DataFrame(leaf)\n\n# Visualising the results:\nACi_struct = PlantBiophysics.ACi(VcMaxRef, JMaxRef, RdRef, df.A, df_sim.A, df[:,:Cᵢ], df_sim.Cᵢ)\nplot(ACi_struct,leg=:bottomright)\n\n# Note that we can also simulate the results using the full photosynthesis model too (Fvcb):\n# Adding the windspeed to simulate the boundary-layer conductance (we put a high value):\ndf[!, :Wind] .= 10.0\n\nleaf = ModelList(\n        photosynthesis = Fvcb(VcMaxRef = VcMaxRef, JMaxRef = JMaxRef, RdRef = RdRef, Tᵣ = 25.0, TPURef = TPURef),\n        # stomatal_conductance = ConstantGs(0.0, df[i,:Gₛ]),\n        stomatal_conductance = Medlyn(0.03, 12.),\n        status = (Tₗ = df.Tₗ, PPFD = df.PPFD, Cₛ = df.Cₐ, Dₗ = 0.1)\n    )\n\nw = Weather(select(df, :T, :P, :Rh, :Cₐ, :T => (x -> 10) => :Wind))\nrun!(leaf, w)\ndf_sim2 = DataFrame(leaf)\n\n# And finally we plot the results:\nACi_struct_full = PlantBiophysics.ACi(VcMaxRef, JMaxRef, RdRef, df.A, df_sim2.A, df[:,:Cᵢ], df_sim2.Cᵢ)\nplot(ACi_struct_full,leg=:bottomright)\n# Note that the results differ a bit because there are more variables that are re-simulated (e.g. Cᵢ)\n\n\n\n\n\n","category":"method"},{"location":"functions/#PlantSimEngine.run!","page":"API","title":"PlantSimEngine.run!","text":"run!(::ConstantA; models, status, meteo, constants=Constants())\n\nConstant photosynthesis (forcing the value).\n\nReturns\n\nModify the leaf status in place for A with a constant value:\n\nA: carbon assimilation, set to leaf.photosynthesis.A (μmol[CO₂] m-2 s-1)\n\nArguments\n\n::ConstantA: a constant assimilation model\nmodels: a ModelList struct holding the parameters for the model.\nstatus: A status, usually the leaf status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nExamples\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\nleaf = ModelList(photosynthesis = ConstantA(26.0))\n\nrun!(leaf,meteo,Constants())\n\nleaf.status.A\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-2","page":"API","title":"PlantSimEngine.run!","text":"run!(::Monteith, models, status, meteo, constants=Constants())\n\nLeaf energy balance according to Monteith and Unsworth (2013), and corrigendum from Schymanski et al. (2017). The computation is close to the one from the MAESPA model (Duursma et al., 2012, Vezy et al., 2018) here. The leaf temperature is computed iteratively to close the energy balance using the mass flux (~ Rn - λE).\n\nArguments\n\n::Monteith: a Monteith model, usually from a model list (i.e. m.energy_balance)\nmodels: A ModelList struct holding the parameters for the model with\n\ninitialisations for:     - Rₛ (W m-2): net shortwave radiation (PAR + NIR). Often computed from a light interception model     - sky_fraction (0-2): view factor between the object and the sky for both faces (see details).     - d (m): characteristic dimension, e.g. leaf width (see eq. 10.9 from Monteith and Unsworth, 2013).\n\nstatus: the status of the model, usually the model list status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nDetails\n\nThe sky_fraction in the variables is equal to 2 if all the leaf is viewing is sky (e.g. in a controlled chamber), 1 if the leaf is e.g. up on the canopy where the upper side of the leaf sees the sky, and the side bellow sees soil + other leaves that are all considered at the same temperature than the leaf, or less than 1 if it is partly shaded.\n\nNotes\n\nIf you want the algorithm to print a message whenever it does not reach convergence, use the debugging mode by executing this in the REPL: ENV[\"JULIA_DEBUG\"] = PlantBiophysics.\n\nMore information here.\n\nExamples\n\nmeteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)\n\n# Using a constant value for Gs:\nleaf = ModelList(\n    energy_balance = Monteith(),\n    photosynthesis = Fvcb(),\n    stomatal_conductance = ConstantGs(0.0, 0.0011),\n    status = (Rₛ = 13.747, sky_fraction = 1.0, d = 0.03)\n)\n\nrun!(leaf,meteo)\nleaf.status.Rn\njulia> 12.902547446281233\n\n# Using the model from Medlyn et al. (2011) for Gs:\nleaf = ModelList(\n    energy_balance = Monteith(),\n    photosynthesis = Fvcb(),\n    stomatal_conductance = Medlyn(0.03, 12.0),\n    status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n)\n\nrun!(leaf,meteo)\nleaf[:Rn]\nleaf[:Rₗₗ]\nleaf[:A]\n\nDataFrame(leaf)\n\nReferences\n\nDuursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.\n\nMonteith, John L., et Mike H. Unsworth. 2013. « Chapter 13 - Steady-State Heat Balance: (i) Water Surfaces, Soil, and Vegetation ». In Principles of Environmental Physics (Fourth Edition), edited by John L. Monteith et Mike H. Unsworth, 217‑47. Boston: Academic Press.\n\nSchymanski, Stanislaus J., et Dani Or. 2017. « Leaf-Scale Experiments Reveal an Important Omission in the Penman–Monteith Equation ». Hydrology and Earth System Sciences 21 (2): 685‑706. https://doi.org/10.5194/hess-21-685-2017.\n\nVezy, Rémi, Mathias Christina, Olivier Roupsard, Yann Nouvellon, Remko Duursma, Belinda Medlyn, Maxime Soma, et al. 2018. « Measuring and modelling energy partitioning in canopies of varying complexity using MAESPA model ». Agricultural and Forest Meteorology 253‑254 (printemps): 203‑17. https://doi.org/10.1016/j.agrformet.2018.02.005.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-3","page":"API","title":"PlantSimEngine.run!","text":"run!(::FvcbIter, models, status, meteo, constants=Constants())\n\nPhotosynthesis using the Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis  (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981). Computation is made following Farquhar & Wong (1984), Leuning et al. (1995), and the Archimed model.\n\nIterative implementation, i.e. the assimilation is computed iteratively over Cᵢ. For the analytical resolution, see Fvcb.\n\nReturns\n\nModify the first argument in place for A, Gₛ and Cᵢ:\n\nA: carbon assimilation (μmol[CO₂] m-2 s-1)\nGₛ: stomatal conductance for CO₂ (mol[CO₂] m-2 s-1)\nCᵢ: intercellular CO₂ concentration (ppm)\n\nArguments\n\n::FvcbIter: Farquhar–von Caemmerer–Berry (FvCB) model with iterative resolution.\nmodels: a ModelList struct holding the parameters for the model with\n\ninitialisations for:     - Tₗ (°C): leaf temperature     - PPFD (μmol m-2 s-1): absorbed Photosynthetic Photon Flux Density     - Gbc (mol m-2 s-1): boundary conductance for CO₂     - Dₗ (kPa): is the difference between the vapour pressure at the leaf surface and the     saturated air vapour pressure in case you're using the stomatal conductance model of Medlyn.\n\nstatus: A status, usually the leaf status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nNote\n\nTₗ, PPFD, Gbc (and Dₗ if you use Medlyn) must be initialized by providing them as keyword arguments (see examples). If in doubt, it is simpler to compute the energy balance of the leaf with the photosynthesis to get those variables. See AbstractEnergy_BalanceModel for more details.\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf =\n    ModelList(\n        photosynthesis = FvcbIter(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Tₗ = 25.0, PPFD = 1000.0, Gbc = 0.67, Dₗ = meteo.VPD)\n    )\n# NB: we need  to initalise Tₗ, PPFD and Gbc.\n\nrun!(leaf,meteo,PlantMeteo.Constants())\nleaf.status.A\nleaf.status.Cᵢ\n\nNote that we use VPD as an approximation of Dₗ here because we don't have the leaf temperature (i.e. Dₗ = VPD when Tₗ = T).\n\nReferences\n\nBaldocchi, Dennis. 1994. « An analytical solution for coupled leaf photosynthesis and stomatal conductance models ». Tree Physiology 14 (7-8‑9): 1069‑79. https://doi.org/10.1093/treephys/14.7-8-9.1069.\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nLeuning, R., F. M. Kelliher, DGG de Pury, et E.D. Schulze. 1995. Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-4","page":"API","title":"PlantSimEngine.run!","text":"run!(::Fvcb, models, status, meteo, constants=Constants())\n\nCoupled photosynthesis and conductance model using the Farquhar–von Caemmerer–Berry (FvCB) model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981) that models the assimilation as the most limiting factor between three processes:\n\nRuBisCo-limited photosynthesis, when the kinetics of the RuBisCo enzyme for fixing\n\nCO₂ is at its maximum (RuBisCo = Ribulose-1,5-bisphosphate carboxylase-oxygenase). It happens mostly when the CO₂ concentration in the stomata is too low. The main parameter is VcMaxRef, the maximum rate of RuBisCo activity at reference temperature. See get_Cᵢᵥ for the computation.\n\nRuBP-limited photosynthesis, when the rate of RuBP (ribulose-1,5-bisphosphate) regeneration\n\nassociated with electron transport rates on the thylakoid membrane (RuBP) is limiting. It happens mostly when light is limiting, or when CO₂ concentration is rather high. It is parameterized using JMaxRef, the potential rate of electron transport. See get_Cᵢⱼ for the computation.\n\nTPU-limited photosynthesis, when the rate at which inorganic phosphate is released for\n\nregenerating ATP from ADP during the utilization of triose phosphate (TPU) is limiting. It happens at very high assimilation rate, when neither light or CO₂ are limiting factors. The parameter is TPURef.\n\nThe computation in this function is made following Farquhar & Wong (1984), Leuning et al. (1995), and the MAESPA model (Duursma et al., 2012).\n\nThe resolution is analytical as first presented in Baldocchi (1994), and needs Cₛ as input. Triose phosphate utilization (TPU) limitation is taken into account as proposed in Lombardozzi (2018) (i.e. Aₚ = 3 * TPURef, making the assumption that glycolate recycling is set to 0). TPURef is set at 9999.0 by default, meaning there is no limitation of photosynthesis by TPU. Note that TPURef can be (badly) approximated using the simple equation TPURef = 0.167 * VcMaxRef as presented in Lombardozzi (2018).\n\nIf you prefer to use Gbc, you can use the iterative implementation of the Fvcb model FvcbIter\n\nIf you want a version that is de-coupled from the stomatal conductance use FvcbRaw, but you'll need Cᵢ as input of the model.\n\nReturns\n\nModify the first argument in place for A, Gₛ and Cᵢ:\n\nA: carbon assimilation (μmol[CO₂] m-2 s-1)\nGₛ: stomatal conductance for CO₂ (mol[CO₂] m-2 s-1)\nCᵢ: intercellular CO₂ concentration (ppm)\n\nArguments\n\n::Fvcb: the Farquhar–von Caemmerer–Berry (FvCB) model\nmodels: a ModelList struct holding the parameters for the model with\n\ninitialisations for:     - Tₗ (°C): leaf temperature     - PPFD (μmol m-2 s-1): absorbed Photosynthetic Photon Flux Density     - Cₛ (ppm): surface CO₂ concentration.     - Dₗ (kPa): vapour pressure difference between the surface and the saturated     air vapour pressure in case you're using the stomatal conductance model of Medlyn.\n\nstatus: A status, usually the leaf status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nNote\n\nTₗ, PPFD, Cₛ (and Dₗ if you use Medlyn) must be initialized by providing them as keyword arguments (see examples). If in doubt, it is simpler to compute the energy balance of the leaf with the photosynthesis to get those variables. See AbstractEnergy_BalanceModel for more details.\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf =\n    ModelList(\n        photosynthesis = Fvcb(),\n        stomatal_conductance = Medlyn(0.03, 12.0),\n        status = (Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n    )\n# NB: we need to initalise Tₗ, PPFD and Cₛ.\n# NB2: we provide the name of the process before the model but it is not mandatory.\n\nrun!(leaf,meteo,PlantMeteo.Constants())\nleaf.status.A\nleaf.status.Cᵢ\n\nNote that we use VPD as an approximation of Dₗ here because we don't have the leaf temperature (i.e. Dₗ = VPD when Tₗ = T).\n\nReferences\n\nBaldocchi, Dennis. 1994. « An analytical solution for coupled leaf photosynthesis and stomatal conductance models ». Tree Physiology 14 (7-8‑9): 1069‑79. https://doi.org/10.1093/treephys/14.7-8-9.1069.\n\nDuursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nLeuning, R., F. M. Kelliher, DGG de Pury, et E.D. Schulze. 1995. « Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.\n\nLombardozzi, L. D. et al. 2018.« Triose phosphate limitation in photosynthesis models reduces leaf photosynthesis and global terrestrial carbon storage ». Environmental Research Letters 13.7: 1748-9326. https://doi.org/10.1088/1748-9326/aacf68.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-5","page":"API","title":"PlantSimEngine.run!","text":"run!(object, meteo, constants = Constants())\n\nComputes the light interception of an object using the Beer-Lambert law.\n\nArguments\n\n::Beer: a Beer model, from the model list (i.e. m.light_interception)\nmodels: A ModelList struct holding the parameters for the model with\n\ninitialisations for LAI (m² m⁻²): the leaf area index.\n\nstatus: the status of the model, usually the model list status (i.e. m.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nExamples\n\nusing PlantSimEngine, PlantBiophysics, PlantMeteo\nm = ModelList(light_interception=Beer(0.5), status=(LAI=2.0,))\n\nmeteo = Atmosphere(T=20.0, Wind=1.0, P=101.3, Rh=0.65, Ri_PAR_f=300.0)\n\nrun!(m, meteo)\n\nm[:PPFD]\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-6","page":"API","title":"PlantSimEngine.run!","text":"run!(::FvcbRaw, models, status, meteo=nothing, constants=Constants())\n\nDirect implementation of the photosynthesis model for C3 photosynthesis from Farquhar–von Caemmerer–Berry (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981).\n\nReturns\n\nModify the first argument in place for A, the carbon assimilation (μmol[CO₂] m-2 s-1).\n\nArguments\n\n::FvcbRaw: the Farquhar–von Caemmerer–Berry (FvCB) model (not coupled)\nmodels: a ModelList struct holding the parameters for the model with\n\ninitialisations for:     - Tₗ (°C): leaf temperature     - PPFD (μmol m-2 s-1): absorbed Photosynthetic Photon Flux Density     - Cₛ (ppm): surface CO₂ concentration.     - Dₗ (kPa): vapour pressure difference between the surface and the saturated     air vapour pressure in case you're using the stomatal conductance model of Medlyn.\n\nstatus: A status, usually the leaf status (i.e. leaf.status)\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nNote\n\nTₗ, PPFD, Cₛ (and Dₗ if you use Medlyn) must be initialized by providing them as keyword arguments (see examples). If in doubt, it is simpler to compute the energy balance of the leaf with the photosynthesis to get those variables. See AbstractEnergy_BalanceModel for more details.\n\nExamples\n\nusing PlantSimEngine\nleaf = ModelList(photosynthesis = FvcbRaw(), status = (Tₗ = 25.0, PPFD = 1000.0, Cᵢ = 400.0))\n# NB: we need Tₗ, PPFD and Cᵢ as inputs (see [`inputs`](@ref))\n\nrun!(leaf)\nleaf.status.A\nleaf.status.Cᵢ\n\n# using several time-steps:\nleaf =\n    ModelList(\n        photosynthesis = FvcbRaw(),\n        status = (Tₗ = [20., 25.0], PPFD = 1000.0, Cᵢ = [380.,400.0])\n    )\n# NB: we need Tₗ, PPFD and Cᵢ as inputs (see [`inputs`](@ref))\n\nrun!(leaf)\nDataFrame(leaf) # fetch the leaf status as a DataFrame\n\nReferences\n\nBaldocchi, Dennis. 1994. « An analytical solution for coupled leaf photosynthesis and stomatal conductance models ». Tree Physiology 14 (7-8‑9): 1069‑79. https://doi.org/10.1093/treephys/14.7-8-9.1069.\n\nDuursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.\n\nFarquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.\n\nLeuning, R., F. M. Kelliher, DGG de Pury, et E.D. Schulze. 1995. « Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.\n\nLombardozzi, L. D. et al. 2018.« Triose phosphate limitation in photosynthesis models reduces leaf photosynthesis and global terrestrial carbon storage ». Environmental Research Letters 13.7: 1748-9326. https://doi.org/10.1088/1748-9326/aacf68.\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-7","page":"API","title":"PlantSimEngine.run!","text":"run!(::ConstantAGs, models, status, meteo, constants=Constants())\n\nConstant photosynthesis coupled with a stomatal conductance model.\n\nReturns\n\nModify the leaf status in place for A, Gₛ and Cᵢ:\n\nA: carbon assimilation, set to leaf.photosynthesis.A (μmol[CO₂] m-2 s-1)\nGₛ: stomatal conductance for CO₂ (mol[CO₂] m-2 s-1)\nCᵢ: intercellular CO₂ concentration (ppm)\n\nArguments\n\n::ConstantAGs: a constant assimilation model coupled to a stomatal conductance model\nmodels: a ModelList struct holding the parameters for the model with\n\ninitialisations for:     - Cₛ (mol m-2 s-1): surface CO₂ concentration.     - any other value needed by the stomatal conductance model.\n\nstatus: A status, usually the leaf status (i.e. leaf.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\nExamples\n\nusing PlantBiophysics, PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\nleaf = ModelList(\n    photosynthesis = ConstantAGs(),\n    stomatal_conductance = Medlyn(0.03, 12.0),\n    status = (Cₛ = 400.0, Dₗ = 2.0)\n)\n\nrun!(leaf,meteo,PlantMeteo.Constants())\n\nstatus(leaf, :A)\nstatus(leaf, :Cᵢ)\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-8","page":"API","title":"PlantSimEngine.run!","text":"run!(::LightIgnore, models::ModelList, status, meteo,constants = Constants())\n\nMethod for when light interception should be explicitely ignored (do nothing).\n\nArguments\n\n::LightIgnore: an Ignore model.\nmodels: a ModelList struct with a missing energy model.\nstatus: the status of the model, usually the one from the models (i.e. models.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-9","page":"API","title":"PlantSimEngine.run!","text":"run!(::Missing, models::ModelList, status, meteo,constants = Constants())\n\nMethod for when energy balance is missing (do nothing).\n\nArguments\n\n::Missing: a Missing model.\nmodels: a ModelList struct with a missing energy model.\nstatus: the status of the model, usually the one from the models (i.e. models.status)\nmeteo: meteorology structure, see Atmosphere\nconstants = PlantMeteo.Constants(): physical constants. See PlantMeteo.Constants for more details\n\n\n\n\n\n","category":"function"},{"location":"functions/#PlantSimEngine.run!-Tuple{ConstantGs, Any, Any, Any}","page":"API","title":"PlantSimEngine.run!","text":"Constant stomatal conductance for CO₂ (mol m-2 s-1).\n\nNote\n\nmeteo or gs_mod are just declared here for compatibility with the call from photosynthesis (need a constant way of calling the functions).\n\n\n\n\n\n","category":"method"},{"location":"models/light/#light_page","page":"Light interception","title":"Light interception","text":"","category":"section"},{"location":"models/light/","page":"Light interception","title":"Light interception","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"models/light/","page":"Light interception","title":"Light interception","text":"The light interception process is the process of computing the radiation interception of components for different wavelength such as PAR (Photosynthetically Active Radication), NIR (Near-Infrared Radiation) and eventually TIR (Thermal Infrared Radiation). Users can also compute particular wavelengths (e.g. red, far-red) depending on the model used.","category":"page"},{"location":"models/light/","page":"Light interception","title":"Light interception","text":"There is only one simple light interception model implemented in PlantBiophysics at the time, the model of Beer-Lambert. Here's an example:","category":"page"},{"location":"models/light/","page":"Light interception","title":"Light interception","text":"using PlantBiophysics, PlantSimEngine\n\nm = ModelList(Beer(0.5), status=(LAI=2.0,))\n\nmeteo = Atmosphere(T=20.0, Wind=1.0, P=101.3, Rh=0.65, Ri_PAR_f=300.0)\n\nrun!(m, meteo)\n\nm","category":"page"},{"location":"models/light/","page":"Light interception","title":"Light interception","text":"note: Note\nIf you have a 3D plant in the OPF format, you can use Archimed-ϕ.","category":"page"},{"location":"extending/implement_a_process/#Implement-a-new-component-models","page":"Implement a process","title":"Implement a new component models","text":"","category":"section"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"using PlantSimEngine, PlantBiophysics, PlantMeteo\nPlantSimEngine.@process growth","category":"page"},{"location":"extending/implement_a_process/#Introduction","page":"Implement a process","title":"Introduction","text":"","category":"section"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"PlantBiophysics.jl is based on PlantSimEngine.jl, a package designed to make the implementation of new processes and models easy and fast.","category":"page"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"You'll find the documentation here.","category":"page"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"You can also take a look at how we implement the processes in this package. For example, the photosynthesis process is implemented like so:","category":"page"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"using PlantSimEngine\n@process \"photosynthesis\" \"...and you can add more docs in this second argument\"","category":"page"},{"location":"extending/implement_a_process/","page":"Implement a process","title":"Implement a process","text":"You can look at the code in src/photosynthesis.jl.","category":"page"},{"location":"simulation/first_simulation/#Simple-simulation","page":"Simple Simulation","title":"Simple simulation","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"simulation/first_simulation/#Running-a-simple-simulation","page":"Simple Simulation","title":"Running a simple simulation","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Here is a first simple simulation of the coupled energy balance on a leaf over one meteorological time-step:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"using PlantBiophysics, PlantSimEngine\n\nmeteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n    )\n\nrun!(leaf,meteo)\n\nleaf","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Now let's describe what is happening here.","category":"page"},{"location":"simulation/first_simulation/#PlantSimEngine","page":"Simple Simulation","title":"PlantSimEngine","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"PlantBiophysics is nothing but an extension of PlantSimEngine.jl. What it really does is implementing biophysical models for PlantSimEngine. So when you use PlantBiophysics, you'll also need to import PlantSimEngine too.","category":"page"},{"location":"simulation/first_simulation/#Meteorology","page":"Simple Simulation","title":"Meteorology","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"The first line of the simulation is calling Atmosphere. Atmosphere is a structure used to describe what are the meteorological conditions in the atmosphere surrounding the leaf, such as the air temperature and humidity, the wind speed or the pressure. It comes from the PlantMeteo.jl package, but it is also exported by PlantSimEngine.","category":"page"},{"location":"simulation/first_simulation/#ModelList","page":"Simple Simulation","title":"ModelList","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"The next command is using ModelList (from PlantSimEngine), which helps us associate models (e.g. Monteith()) to processes (e.g. energy_balance). Currently PlantBiophysics.jl implements three processes: the energy balance, the photosynthesis, and the stomatal conductance. For each of these processes, we can choose a model that will be used for its simulation. The package provides processes and models, but you can also implement your own by following the tutorial here.","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"In our example we use the Monteith et al. (2013) model implementation for the energy balance (Monteith()), the Farquhar et al. (1980) model for the photosynthesis (Fvcb()), and the Medlyn et al. (2011) model for the stomatal conductance (Medlyn(0.03, 12.0)). All are available from PlantBiophysics.jl.","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Each model has its own structure used to provide the parameter values. For example the stomatal conductance model of Medlyn et al. (2011) need two parameters: g0 and g1. We pass both values when calling the structure here: Medlyn(0.03, 12.0). In our example, we use the default values for the two other models used, so they are called without passing any argument.","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Then we provide the initializations for some variables in the status keyword argument: Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03. The variables that need to be initialized depend on the combination of models we are using. One way to know which variables should be instantiated is to use to_initialize from PlantSimEngine.jl:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"to_initialize(ModelList(Monteith(), Fvcb(), Medlyn(0.03, 12.0)))","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"It returns a list of the variables that need to be initialized for each independent process. If some processes are coupled, it only returns the ones from the root process that calls the others.","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"When we know which parameters have to be initialized, we can get the list of the parameters for each model by looking at its field names:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"fieldnames(Fvcb)","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Or look into the documentation of the structure (e.g. ?Fvcb) or the documentation of the process (e.g. ?AbstractPhotosynthesisModel) to get more information such as the units.","category":"page"},{"location":"simulation/first_simulation/#Model-coupling","page":"Simple Simulation","title":"Model coupling","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"PlantSimEngine handles all model coupling and the order of execution of the processes. The user only needs to provide the list of models and the initializations. The package takes care of the rest by building a dependency graph and executing the processes in the right order considering the soft and hard dependencies. You can take a look at these concepts in the PlantSimEngine documentation.","category":"page"},{"location":"simulation/first_simulation/#Results","page":"Simple Simulation","title":"Results","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"The results of the computations are stored in the status field of the model list. To get the value for each given variable we can just index the object like so:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"leaf[:A]","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Another simpler way to get all the results at once is to use DataFrame:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"using DataFrames\nDataFrame(leaf)","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Or simply by printing the object:","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"leaf","category":"page"},{"location":"simulation/first_simulation/#Wrap-up","page":"Simple Simulation","title":"Wrap-up","text":"","category":"section"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"We learned to run a simple simulation, along with some details about the simulation, the structures and some helper functions.","category":"page"},{"location":"simulation/first_simulation/","page":"Simple Simulation","title":"Simple Simulation","text":"Next, we'll learn to run a simulation over several time-steps.","category":"page"},{"location":"concepts/package_design/#Package-design","page":"Design","title":"Package design","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"PlantBiophysics.jl is designed to ease the computations of biophysical processes in plants and other objects. It uses PlantSimEngine.jl, so it shares the same ontology (same concepts and terms).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing DataFrames","category":"page"},{"location":"concepts/package_design/#Definitions","page":"Design","title":"Definitions","text":"","category":"section"},{"location":"concepts/package_design/#Processes","page":"Design","title":"Processes","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"A process is defined in PlantSimEngine as a biological or a physical phenomena. At this time PlantBiophysics.jl implements four processes:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"light interception\nenergy balance\nphotosynthesis\nstomatal conductance","category":"page"},{"location":"concepts/package_design/#Models","page":"Design","title":"Models","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"A process is simulated using a particular implementation of a model. Each model is implemented using a structure that lists the parameters of the model. For example, PlantBiophysics provides the Beer structure for the implementation of the Beer-Lambert law of light extinction.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"You can see the list of available models for each process in the sections about the models, e.g. here for photosynthesis.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Models can use three types of entries:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Parameters\nMeteorological information\nVariables","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Parameters are constant values that are used by the model to compute its outputs. Meteorological information are values that are provided by the user and are used as inputs to the model. Variables are computed by the model and can optionally be initialized before the simulation.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Users can choose which model is used to simulate a process using the ModelList structure from PlantSimEngine. ModelList is also used to store the values of the parameters, and to initialize variables.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Let's instantiate a ModelList with the Beer-Lambert model of light extinction. The model is implemented with the Beer structure and has only one parameter: the extinction coefficient (k).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantSimEngine, PlantBiophysics\nModelList(Beer(0.5))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"What happened here? We provided an instance of a model to a ModelList that automatically associates it to the process it simulates (i.e. the light interception).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"tip: Tip\nWe see that we only instantiated the ModelList for the light extinction process. What about the others like photosynthesis or energy balance ? Well there is no need to give models if we have no intention to simulate them.","category":"page"},{"location":"concepts/package_design/#Parameters","page":"Design","title":"Parameters","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"A parameter is a constant value that is used by a model to compute its outputs. For example, the Beer-Lambert model uses the extinction coefficient (k) to compute the light extinction. The Beer-Lambert model is implemented with the Beer structure, which has only one field: k. We can see that using fieldnames:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"fieldnames(Beer)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Some models are shipped with default values for their parameters. For example, the Monteith model that simulates the energy balance has a default value for all its parameters. Here are the parameter names:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"fieldnames(Monteith)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"And their default values:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Monteith()","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"But if we need to change the values of some parameters, we can usually give them as keyword arguments:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Monteith(maxiter = 100, ΔT = 0.001)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Perfect! Now is that all we need to make a simulation? Well, usually no. Models need parameters, but also input variables.","category":"page"},{"location":"concepts/package_design/#Variables-(inputs,-outputs)","page":"Design","title":"Variables (inputs, outputs)","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Variables are computed by models, and can optionally be initialized before the simulation. Variables and their values are stored in the ModelList, and are initialized automatically or manually.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Hence, ModelList objects store two fields:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"fieldnames(ModelList)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The first field is a list of models associated to the processes they simulate. The second, :status, is used to hold all inputs and outputs of our models, called variables. For example the Beer model needs the leaf area index (LAI, m^{2} \\cdot m^{-2}) to run.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can see which variables are needed as inputs using inputs from PlantSimEngine:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantSimEngine\ninputs(Beer(0.5))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can also see the outputs of the model using outputs from PlantSimEngine:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantSimEngine\noutputs(Beer(0.5))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"If we instantiate a ModelList with the Beer-Lambert model, we can see that the :status field has two variables: LAI and PPDF. The first is an input, the second an output.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantSimEngine, PlantBiophysics\nm = ModelList(Beer(0.5))\nkeys(m.status)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"To know which variables should be initialized, we can use to_initialize from PlantSimEngine:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"m = ModelList(Beer(0.5))\n\nto_initialize(m)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Their values are uninitialized though (hence the warnings):","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"(m[:LAI], m[:PPFD])","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Uninitialized variables have often the value returned by typemin(), e.g. -Inf for Float64:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"typemin(Float64)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"tip: Tip\nPrefer using to_initialize rather than inputs to check which variables should be initialized. inputs returns the variables that are needed by the model to run, but to_initialize returns the variables that are needed by the model to run and that are not initialized. Also to_initialize is more clever when coupling models (see below).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can initialize the variables by providing their values to the status at instantiation:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"m = ModelList(Beer(0.5), status = (LAI = 2.0,))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Or after instantiation using init_status! (from PlantSimEngine):","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"m = ModelList(Beer(0.5))\n\ninit_status!(m, LAI = 2.0)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can check if a component is correctly initialized using is_initialized (from PlantSimEngine):","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"is_initialized(m)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Some variables are inputs of models, but outputs of other models. When we couple models, we have to be careful to initialize only the variables that are not computed.","category":"page"},{"location":"concepts/package_design/#Climate-forcing","page":"Design","title":"Climate forcing","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"To make a simulation, we usually need the climatic/meteorological conditions measured close to the object or component.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The PlantMeteo.jl package provides a data structure to declare those conditions, and to pre-compute other required variables. The most basic data structure is a type called Atmosphere, which defines the conditions for a steady-state, i.e. the conditions are considered at equilibrium. Another structure is available to define different consecutive time-steps: Weather.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The mandatory variables to provide for an Atmosphere are: T (air temperature in °C), Rh (relative humidity, 0-1), Wind (the wind speed in m s-1) and P (the air pressure in kPa). We can declare such conditions like so:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"More details are available from the dedicated section.","category":"page"},{"location":"concepts/package_design/#Simulation","page":"Design","title":"Simulation","text":"","category":"section"},{"location":"concepts/package_design/#Simulation-of-processes","page":"Design","title":"Simulation of processes","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Making a simulation is rather simple, we simply use the run! function provided by PlantSimEngine:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"run!(model_list, meteo)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The first argument is the model list (see ModelList from PlantSimEngine), and the second defines the micro-climatic conditions (more details below in Climate forcing).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The ModelList should be initialized for the given process before calling run!. See Variables (inputs, outputs) for more details.","category":"page"},{"location":"concepts/package_design/#Example-simulation","page":"Design","title":"Example simulation","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"For example we can simulate the stomatal_conductance of a leaf like so:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using PlantMeteo, PlantSimEngine, PlantBiophysics\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(\n    Medlyn(0.03, 12.0),\n    status = (A = 20.0, Dₗ = meteo.VPD, Cₛ = 400.0)\n)\n\nrun!(leaf, meteo)\n\nleaf[:Gₛ]","category":"page"},{"location":"concepts/package_design/#Outputs","page":"Design","title":"Outputs","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The status field of a ModelList is used to initialize the variables before simulation and then to keep track of their values during and after the simulation. We can extract the simulation outputs of a model list using the status function (from PlantSimEngine).","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The status can either be a Status type if simulating only one time-step, or a TimeStepTable (from PlantMeteo) if several.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Let's look at the status of our previous simulated leaf:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"status(leaf)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can extract the value of one variable using the status function, e.g. for the stomatal conductance:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"status(leaf, :Gₛ)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Or similarly using the dot syntax:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"leaf.status.Gₛ","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Or much simpler (and recommended), by indexing directly the model list:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"leaf[:Gₛ]","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Another simple way to get the results is to transform the outputs into a DataFrame:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"using DataFrames\nDataFrame(leaf)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"note: Note\nThe output from DataFrame is adapted to the kind of simulation you did: one row per time-steps, and per component models if you simulated several.","category":"page"},{"location":"concepts/package_design/#Model-coupling","page":"Design","title":"Model coupling","text":"","category":"section"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"A model can work either independently or in conjunction with other models. For example a stomatal conductance model is often associated with a photosynthesis model, i.e. it is called from the photosynthesis model.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Several models proposed in PlantBiophysics.jl are hard-coupled models, i.e. one model calls another. For example, the Fvcb structure is the implementation of the Farquhar–von Caemmerer–Berry model for C3 photosynthesis (Farquhar et al., 1980; von Caemmerer and Farquhar, 1981) calls a stomatal conductance model. Hence, using Fvcb requires a stomatal conductance model in the ModelList to compute Gₛ.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We can use the stomatal conductance model of Medlyn et al. (2011) as an example to compute it. It is implemented with the Medlyn structure. We can then create a ModelList with the two models:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"ModelList(Fvcb(), Medlyn(0.03, 12.0))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Now this instantiation returns some warnings saying we need to initialize some variables.","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The Fvcb model requires the following variables as inputs:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"inputs(Fvcb())","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"And the Medlyn model requires the following variables:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"inputs(Medlyn(0.03, 12.0))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"We see that A is needed as input of Medlyn, but we also know that it is an output of Fvcb. This is why we prefer using to_initialize from PlantSimEngine.jl instead of inputs, because it returns only the variables that need to be initialized, considering that some inputs are duplicated between models, and some are computed by other models (they are outputs of a model):","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"to_initialize(ModelList(Fvcb(), Medlyn(0.03, 12.0)))","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"The most straightforward way of initializing a model list is by giving the initializations to the status keyword argument during instantiation:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"m = ModelList(\n    Fvcb(),\n    Medlyn(0.03, 12.0),\n    status = (Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = 0.82)\n)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Our component models structure is now fully parameterized and initialized for a simulation!","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"Let's simulate it:","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"run!(m)","category":"page"},{"location":"concepts/package_design/","page":"Design","title":"Design","text":"tip: Tip\nThe models included in the package are listed in their own section, i.e. here for photosynthesis.","category":"page"},{"location":"extending/implement_a_model/#model_implementation_page","page":"Implement a model","title":"Model implementation in 5 minutes","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"using PlantBiophysics\nusing PlantSimEngine\nusing PlantMeteo","category":"page"},{"location":"extending/implement_a_model/#Introduction","page":"Implement a model","title":"Introduction","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"PlantBiophysics.jl was designed to make new model implementation very simple thanks to PlantSimEngine. So let's learn about how to implement your own model with a simple example: implementing a new stomatal conductance model.","category":"page"},{"location":"extending/implement_a_model/#Inspiration","page":"Implement a model","title":"Inspiration","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"If you want to implement a new model, the best way to do it is to start from another implementation.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"So for a photosynthesis model, I advise you to look at the implementation of the FvCB model in this Julia file: src/photosynthesis/FvCB.jl.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"For an energy balance model you can look at the implementation of the Monteith model in src/energy/Monteith.jl, and for a stomatal conductance model in src/conductances/stomatal/medlyn.jl.","category":"page"},{"location":"extending/implement_a_model/#Requirements","page":"Implement a model","title":"Requirements","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"In those files, you'll see that in order to implement a new model you'll need to implement:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"a structure, used to hold the parameter values and to dispatch to the right method\nthe actual model, developed as a method for the run! function\nsome helper functions used by the package and/or the users","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Let's take a simple example with a new model for the stomatal conductance: the Ball and Berry model.","category":"page"},{"location":"extending/implement_a_model/#Example:-the-Ball-and-Berry-model","page":"Implement a model","title":"Example: the Ball and Berry model","text":"","category":"section"},{"location":"extending/implement_a_model/#The-structure","page":"Implement a model","title":"The structure","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The first thing to do is to implement a structure for your model.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The purpose of the structure is two-fold:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"hold the parameter values\ndispatch to the right method when calling the process function","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Let's take the stomatal conductance model from Medlyn et al. (2011) as a starting point. The structure of the model (or type) is defined as follows:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"struct Medlyn{T} <: AbstractStomatal_ConductanceModel\n    g0::T\n    g1::T\n    gs_min::T\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The first line defines the name of the model (Medlyn), with the types that will be used for the parameters. Then it defines the structure as a subtype of AbstractStomatal_ConductanceModel. This step is very important as it tells to the package what kind of process the model simulates. In this case, it is a stomatal conductance model, that's why we use AbstractStomatal_ConductanceModel. We would use AbstractPhotosynthesisModel instead for a photosynthesis model, AbstractEnergy_BalanceModel for an energy balance model, and AbstractLight_InterceptionModel for a light interception model.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"These abstract structures are automatically defined when defining a process using the @process macro from PlantSimEngine.jl (which PlantBiophysics is built upon). ","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"For another example, the Fvcb model is a subtype of AbstractPhotosynthesisModel. You can check this using:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Fvcb <: AbstractPhotosynthesisModel","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Then comes the parameters names, and their types. The type of the parameters is always forced to be of the same type in our example. This is done using the T notation as follows:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"we say that our structure Medlyn is a parameterized struct by putting T in between brackets after the name of the struct\nWe put ::T after our parameter names in the struct. This way Julia knows that all parameters must be of same type T.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The T is completely free, you can use any other letter or word instead. If you have parameters that you know will be of different types, you can either force their type, or make them parameterizable too, using another letter, e.g.:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"struct YourStruct{T,S} <: AbstractStomatal_ConductanceModel\n    g0::T\n    g1::T\n    gs_min::T\n    integer_param::S\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Parameterized types are very useful because they let the user choose the type of the parameters, and potentially dispatch on them.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"But why not forcing the type such as the following:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"struct YourStruct <: AbstractStomatal_ConductanceModel\n    g0::Float64\n    g1::Float64\n    gs_min::Float64\n    integer_param::Int\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Well, you can do that. But you'll lose a lot of the magic Julia has to offer this way.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"For example a user could use the Particles type from MonteCarloMeasurements.jl to make automatic uncertainty propagation, and this is only possible if the type is parameterizable.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"So let's implement a new structure for our stomatal conductance model:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"struct BandB{T} <: AbstractStomatal_ConductanceModel\n    g0::T\n    g1::T\n    gs_min::T\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Well, the only thing we had to change relative to the one from Medlyn is the name, easy! This is because both models share the same parameters.","category":"page"},{"location":"extending/implement_a_model/#The-method","page":"Implement a model","title":"The method","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The models are implemented as a new method for the run! function. The tailing exclamation point is used in Julia to tell users the function is mutating its input, i.e. it modifies it.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Your implementation should always modify the input status and return nothing. This ensures that models compute fast.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"We extend run! because then PlantSimEngine handles every other details, such as checking that the object is correctly initialized, building the dependency graph between models, applying the computations over objects and time-steps in parallel, etc... This is nice because as a developer you don't have to deal with those details, and you can just concentrate on your implementation.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"note: Note\nIf your model calls another one (hard-coupled), you'll have to use the internal call directly to avoid the overheads of the generic functions to avoid all checks for performance.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Here we are trying to implement a new stomatal conductance model. Well, this one is the most complicated process to implement actually, because it is computed on two steps: run! and gs_closure.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"gs_closure is the function that actually implements the conductance model, but only the stomatal closure part. This one does not modify its input, it computes the result and returns it. Then run! uses this output to compute the stomatal conductance. But why not implementing just run!? Because gs_closure is used elsewhere, usually in the photosynthesis model, before actually computing the stomatal conductance.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"In practice, the run! implementation is rather generic and will not be modified by developers. They will rather implement their method for gs_closure, that will be used automatically by run!.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"warning: Warning\nWe need to import all the functions we need to use or extend, so Julia knows we are extending the methods from PlantSimEngine, and not defining our own functions. To do so, you can prefix the functions by the package name, or import them once e.g.:    import PlantSimEngine: inputs_, outputs_\n    import PlantBiohysics: run!, run!","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"So let's do it! Here is our own implementation of the stomatal closure for a ModelList component models:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"function PlantBiophysics.gs_closure(::BandB, models, status, meteo, constants, extra)\n    models.stomatal_conductance.g1 * meteo.Rh / status.Cₛ\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The first argument (::BandB) means this method will only execute when the function is called with a first argument that is of type BandB. This is our way of telling Julia that this method is implementing the BandB algorithm.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"An important thing to note is that our variables are stored in different structures:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"models: the models parameters\nstatus: the input and output variables of the models\nmeteo: the micro-climatic conditions\nconstants: the constants\nextras: any other value or object, this is used for example to pass the node of a MultiScaleTreeGraph","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"note: Note\nThe micro-meteorological conditions are always given for one time-step inside the models methods. The conditions with several time-steps are handled earlier by the generic functions.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"OK ! So that's it ? Almost. One last thing to do is to define a method for inputs/outputs so that PlantSimEngine knows which variables are needed for our model, and which it computes. Remember that the actual model is implemented for run!, so we have to tell PlantSimEngine which ones are needed, and what are their default value:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Inputs: :Rh and :Cₛ for our specific implementation, and :A for run!\nOutputs: our model does not compute any new variable, and run! computes, well, :Gₛ","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Here is how we actually implement our methods:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"import PlantSimEngine\nfunction PlantSimEngine.inputs_(::BandB)\n    (Rh=-Inf,Cₛ=-Inf,A=-Inf)\nend\n\nfunction PlantSimEngine.outputs_(::BandB)\n    (Gₛ=-Inf,)\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Note that both function end with an \"\". This is because these functions are internal, they will not be called by the users directly. Users will use inputs and outputs instead, which call `inputsandoutputs_`, but stripping out the default values.","category":"page"},{"location":"extending/implement_a_model/#The-utility-functions","page":"Implement a model","title":"The utility functions","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Before running a simulation, you can do a little bit more for your implementation (optional).","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"First, you can add a method for type promotion:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"function BandB(g0,g1,gs_min)\n    BandB(promote(g0,g1,gs_min))\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"This allows your user to instantiate your model parameters using different types of inputs. For example they may use this:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"BandB(0,2.0,0.001)","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"You don't see a problem? Well your users won't either.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Here's the problem: we use parametric types, and when we declared our structure, we said that all fields in our type will share the same type. This is the T here:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"struct BandB{T} <: AbstractStomatal_ConductanceModel\n    g0::T\n    g1::T\n    gs_min::T\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"And in our example above, the user provides 0 as the first argument. Well, this is an integer, not a floating point number like the two others. That's were the promotion is really helpful. It will convert all your inputs to the same type. In our example it will convert 0 to 0.0.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"A second thing also is to help your user with default values for some parameters (if applicable). For example a user will almost never change the value of the minimum stomatal conductance. So we can provide a default value like so:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"BandB(g0,g1) = BandB(g0, g1, oftype(0.001, g0))","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Now the user can call BandB with only two values, and the third one will be set to 0.001.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Another useful thing to provide to the user is the ability to instantiate your model type with keyword values. You can do it by adding the following method:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"BandB(;g0,g1) = BandB(g0,g1,oftype(g0,0.001))","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Did you notice the ; before the argument? It tells Julia that we want those arguments provided as keywords, so now we can call BandB like this:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"BandB(g0 = 0.0, g1 = 2.0)","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"This is nice, but again, completely optional.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"One more thing to implement is a method for the dep function that tells PlantSimEngine which processes (and models) are needed for your model to run (i.e. if your model is coupled to another model).","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Our example model does not call another model, so we don't need to implement it. But we can look at e.g. the implementation for Fvcb to see how it works:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"PlantSimEngine.dep(::Fvcb) = (stomatal_conductance=AbstractStomatal_ConductanceModel,)","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Here we say to PlantSimEngine that the Fvcb model needs a model of type AbstractStomatal_ConductanceModel in the stomatal conductance process.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The last optional thing to implement is a method for the eltype function:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Base.eltype(x::BandB{T}) where {T} = T","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"This one helps Julia to know the type of the elements in your structure, and make it faster.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"OK that's it! Now you have a full new implementation of the stomatal conductance model! I hope it was clear and you understood everything. If you think some sections could be improved, you can make a PR on this doc, or open an issue so I can improve it.","category":"page"},{"location":"extending/implement_a_model/#More-details-on-model-implementations","page":"Implement a model","title":"More details on model implementations","text":"","category":"section"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Here is another example with a different approach in case you need it. So let's change our example from the stomatal conductance to the photosynthesis. For example Fvcb implements the model or Farquhar et al. (1980) to simulate the photosynthesis of C3 plants.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"When the user calls run!, PlantBiophysics looks into the component models type, and the type of the model implemented for the photosynthesis, in this case, Fvcb.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Then, it calls another, internal method of run! that will dispatch the computation to the method that implements the model. This method looks like this:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"function PlantSimEngine.run!(::Fvcb, models, status, meteo, constants=Constants(), extras=nothing)\n\n    [...]\n\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Where [...] represent the lines of code implementing the model (not shown here).","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The interesting bit is in the function declaration at the top. This is where all the magic happens. The first argument let Julia know that this is the method for computing the Fvcb model.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Now if we look again at what are the fields of a ModelList:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"fieldnames(ModelList)","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"we see that it has two fields: models and status. The first one is a list of models named after the process they simulate. So if we want to simulate the photosynthesis with the Fvcb model, our ModelList needs an instance of the Fvcb structure for the photosynthesis process, like so:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"leaf = ModelList(Fvcb());\nleaf.models.photosynthesis","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"The photosynthesis field is then used as the first argument to the call to the internal method of run!, which will call the method that implements Fvcb, because our photosynthesis field is of type Fvcb.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"So if we want to implement our own model for the photosynthesis, we could do:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"# Make the struct to hold the parameters:\nstruct OurModel{T} <: AbstractPhotosynthesisModel\n    a::T\n    b::T\n    c::T\nend\n\n# Instantiate the struct with default values + kwargs:\nfunction OurModel(;a = 400.0, b = 1000.0, c = 1.5)\n    OurModel(promote(a,b)...)\nend\n\n# Define inputs:\nfunction PlantSimEngine.inputs_(::OurModel)\n    (PPFD=-Inf, Tₗ=-Inf, Cₛ=-Inf)\nend\n\n# Define outputs:\nfunction PlantSimEngine.outputs_(::OurModel)\n    (A=-Inf, Gₛ=-Inf)\nend\n\n# Tells Julia what is the type of elements:\nBase.eltype(x::OurModel{T}) where {T} = T\n\n# Implement the photosynthesis model:\nfunction PlantSimEngine.run!(::OurModel, models, status, meteo, constants=Constants(), extras=nothing)\n\n    status.A =\n        status.Cₛ / models.photosynthesis.a +\n        status.PPFD / models.photosynthesis.b +\n        status.Tₗ / models.photosynthesis.c\n\n    PlantSimEngine.run!(models.stomatal_conductance, models, status, meteo, constants, extras)\nend","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"🥳 And that's it! 🥳","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"We have a new model for photosynthesis that is coupled with the stomatal conductance.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"warning: Warning\nThis is a dummy photosynthesis model. Don't use it, it is very wrong biologically speaking!","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"note: Note\nNotice that we compute the stomatal conductance directly using the internal method of run! that takes the type of model as first argument. We do this for speed, because the generic function run! does some checks on its inputs every time it is called, while the internal method only does the computation. We don't need the extra checks and dependency graph computations because they are already done at the first call.","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"Now if we want to make a simulation, we can simply do:","category":"page"},{"location":"extending/implement_a_model/","page":"Implement a model","title":"Implement a model","text":"using PlantMeteo\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf =\n    ModelList(\n        OurModel(1.0, 2.0, 3.0),\n        Medlyn(0.03, 12.0),\n        status = (Tₗ = 25.0, PPFD = 1000.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n    )\n# NB: we need  to initalise Tₗ, PPFD and Cₛ\n\nrun!(leaf,meteo,Constants())\nleaf[:A]","category":"page"},{"location":"simulation/uncertainty_propagation/#uncertainty_propagation_page","page":"Tutorial: Uncertainty propagation","title":"Uncertainty propagation","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\nusing MonteCarloMeasurements\nusing Plots\nusing Dates\n# Toggle the use of a comparison function (using `mean`):\nunsafe_comparisons(true)\nmeteo = Atmosphere(T = 22.0 ± 0.1, Wind = 0.8333 ± 0.1, P = 101.325 ± 1., Rh = 0.4490995 ± 0.02, Cₐ = 400. ± 1.)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747 ± 1., sky_fraction = 1.0, PPFD = 1500.0 ± 1., d = 0.03 ± 0.001),\n        type_promotion = Dict(Float64 => Particles{Float64,2000})\n    )","category":"page"},{"location":"simulation/uncertainty_propagation/#Introduction","page":"Tutorial: Uncertainty propagation","title":"Introduction","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"We can very easily propagate uncertainties in all computations in PlantBiophysics using either Measurements.jl or MonteCarloMeasurements.jl. So instead of using classic data types such as Float64 for parameter values, micro-meteorological conditions or initial values, we use a specific data type that propagates distributions rather than scalars.","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Measurements.jl provides a very fast way to propagate errors, but is only suited for linear processes. MonteCarloMeasurements.jl in the other hand is slower but provides a better estimation of the propagation for non-linear processes. The main idea of Monte Carlo methods is to simulate the problem for a large number of times, randomly drawing inputs in the distributions specified by the user. We then get distributions as outputs (and means/standard deviations).","category":"page"},{"location":"simulation/uncertainty_propagation/#Example:-normal-distributions","page":"Tutorial: Uncertainty propagation","title":"Example: normal distributions","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Let's first import all packages we need:","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo, MonteCarloMeasurements, Plots, Dates\n# Toggle the use of a comparison function (using `mean`):\nunsafe_comparisons(true)","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"We can use the μ ± σ notation for the values of the parameters and micro-meteorological conditions to create a Gaussian distribution (of mean μ and standard deviation σ):","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"meteo = Atmosphere(T = 22.0 ± 0.1, Wind = 0.8333 ± 0.1, P = 101.325 ± 1., Rh = 0.4490995 ± 0.02, Cₐ = 400. ± 1.)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747 ± 1., sky_fraction = 1.0, PPFD = 1500.0 ± 1., d = 0.03 ± 0.001),\n        type_promotion = Dict(Float64 => Particles{Float64,2000})\n    )","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Now our parameters and conditions are not scalars, but Particles, which are n sampled values in the μ ± σ distributions. By default n = 2000.","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"We can now run our simulation:","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"run!(leaf,meteo)","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"And now we can plot the resulting inputs/outputs values:","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"p1 = plot(meteo.T,legend=:false,xlabel=\"Tₐ (°C)\",ylabel=\"density\",dpi=300,title=\"(a)\",titlefontsize=9)\np2 = plot(leaf.status.d[1],legend=:false,xlabel=\"d (m)\",ylabel=\"density\",dpi=300,title=\"(b)\",titlefontsize=9)\np3 = plot(leaf.status.Tₗ[1],legend=:false,xlabel=\"Tₗ (°C)\",ylabel=\"density\",dpi=300,title=\"(c)\",titlefontsize=9)\np4 = plot(leaf.status.A[1],legend=:false,xlabel=\"A\",ylabel=\"density\",dpi=300,title=\"(d)\",titlefontsize=9)\nplot(p1,p2,p3,p4,dpi=300,titleloc=:right)\nsavefig(\"distributions-example-gaussian.svg\"); nothing #hide","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"(Image: )","category":"page"},{"location":"simulation/uncertainty_propagation/#Example:-other-distributions","page":"Tutorial: Uncertainty propagation","title":"Example: other distributions","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"It is also possible to use other types of distributions. For example the a .. b notation will set a uniform distribution in the interval [a,b]). For others distributions, you can use the package Distributions.jl to use any other distributions (Binomial, Gamma, etc...) as a ⊠ Gamma(1) (i.e. a plus a Gamma distribution of parameter 1) or a ⊠ Exponential(1) (i.e. an exponential distribution of parameter 1 with a as factor).","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Here's an example usage:","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"# ⊞ \\boxplus\n# ⊠ \\boxtimes\n\nmeteo = Atmosphere(T = 15.0 .. 18.0, Wind = 0.8333 ± 0.1, P = 101.325 ± 1., Rh = 0.4490995 ± 0.02, Cₐ = 400. ± 1.)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747 ± 1., sky_fraction = 1.0, PPFD = 1500.0 ± 1., d = 0.01 .. 0.03),\n        type_promotion = Dict(Float64 => Particles{Float64,2000})\n    )\n\nrun!(leaf,meteo)\n\np1 = plot(meteo.T,legend=:false,xlabel=\"Tₐ (°C)\",ylabel=\"density\",dpi=300,title=\"(a)\",titlefontsize=9)\np2 = plot(leaf.status.d[1],legend=:false,xlabel=\"d (m)\",ylabel=\"density\",dpi=300,title=\"(b)\",titlefontsize=9)\np3 = plot(leaf.status.Tₗ[1],legend=:false,xlabel=\"Tₗ (°C)\",ylabel=\"density\",dpi=300,title=\"(c)\",titlefontsize=9)\np4 = plot(leaf.status.A[1],legend=:false,xlabel=\"A\",ylabel=\"density\",dpi=300,title=\"(d)\",titlefontsize=9)\nplot(p1,p2,p3,p4,dpi=300,titleloc=:right)\nsavefig(\"distributions-example-various.svg\"); nothing #hide","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"(Image: )","category":"page"},{"location":"simulation/uncertainty_propagation/#Plotting","page":"Tutorial: Uncertainty propagation","title":"Plotting","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Plotting values of type MonteCarloMeasurements.jl is allowed using plot as it were scalars. It will plot confidence interval too. You can also check specific MonteCarloMeasurements.jl function ribbonplot (more details in part Plotting of the package documentation).","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"For example we can simulate a leaf energy balance over consecutive time-steps:","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"weather = read_weather(\n    joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./ 100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)\n\nleaf = ModelList(\n        Monteith(),\n        Fvcb(),\n        Medlyn(0.03, 12.0),\n        status = (Rₛ = 13.747 ± 2., sky_fraction = 0.6..1.0, PPFD = 1500.0 ± 100., d = [0.03,0.03,0.03]),\n        type_promotion = Dict(Float64 => Particles{Float64,2000})\n    )\n\nrun!(leaf, weather)\n\nribbonplot(weather[:date], leaf[:Tₗ], alpha = 0.2, ylab = \"Leaf Temperature\", xlab = \"Time\")\nsavefig(\"error-ribbon.svg\"); nothing #hide","category":"page"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"(Image: )","category":"page"},{"location":"simulation/uncertainty_propagation/#Performance","page":"Tutorial: Uncertainty propagation","title":"Performance","text":"","category":"section"},{"location":"simulation/uncertainty_propagation/","page":"Tutorial: Uncertainty propagation","title":"Tutorial: Uncertainty propagation","text":"Monte Carlo results are highly dependent on the number of simulations given by the number of particles n. But keep in mind that the result of an uncertainty propagation with a low n is more unreliable than with a higher n.","category":"page"},{"location":"simulation/mtg_simulation/#Simulation-on-a-plant-(MTG)","page":"Whole-plant simulation","title":"Simulation on a plant (MTG)","text":"","category":"section"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo, MultiScaleTreeGraph, PlantGeom\nusing CairoMakie, Dates\n\nmtg = read_opf(joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"scene\", \"opf\", \"coffee.opf\"))\n\nweather = read_weather(\n    joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./ 100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)\n\nmodels = read_model(joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"models\", \"plant_coffee.yml\"));\n\ntransform!(\n    mtg,\n    [:Ra_PAR_f, :Ra_NIR_f] => ((x, y) -> x + y * 1.2) => :Rᵢ, # This would be the incident radiation\n    [:Ra_PAR_f, :Ra_NIR_f] => ((x, y) -> x + y) => :Rₛ,\n    :Ra_PAR_f => (x -> x * 4.57) => :PPFD,\n    (x -> 0.3) => :d,\n    ignore_nothing = true\n)\n\ninit_mtg_models!(mtg, models, length(weather))\n\nrun!(mtg, weather)\n\ntransform!(\n    mtg,\n    :Tₗ => (x -> x[1]) => :Tₗ_1,\n    ignore_nothing = true\n)","category":"page"},{"location":"simulation/mtg_simulation/#Multi-scale-Tree-Graph","page":"Whole-plant simulation","title":"Multi-scale Tree Graph","text":"","category":"section"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"The Multi-scale Tree Graph, or MTG for short is a data structure that helps represent a plant topology, and optionally its geometry.","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"The OPF is a file format that stores an MTG with geometry onto the disk. Let's read an example OPF using read_opf(), a function from the PlantGeom package:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"using PlantGeom\nmtg = read_opf(joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"scene\", \"opf\", \"coffee.opf\"))","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"The result is an MTG defining the plant at several scales using a tree graph. You can read the introduction to the MTG from MultiScaleTreeGraph.jl's documentation if you want to understand how it works.","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"Now let's import the weather data:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"using PlantBiophysics, PlantSimEngine, PlantMeteo\n\nweather = read_weather(\n    joinpath(dirname(dirname(pathof(PlantMeteo))), \"test\", \"data\", \"meteo.csv\"),\n    :temperature => :T,\n    :relativeHumidity => (x -> x ./ 100) => :Rh,\n    :wind => :Wind,\n    :atmosphereCO2_ppm => :Cₐ,\n    date_format = DateFormat(\"yyyy/mm/dd\")\n)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"And read the models associated to the MTG from a YAML file:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"file = joinpath(dirname(dirname(pathof(PlantBiophysics))), \"test\", \"inputs\", \"models\", \"plant_coffee.yml\")\nmodels = read_model(file)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"Let's check which variables we need to provide for our model configuration:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"to_initialize(models)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"OK, only the \"Leaf\" component must be initialized before computation for the coupled energy balance, with the shortwave radiation Rₛ, the visible sky fraction seen by the object sky_fraction, the characteristic dimension of the object d and the Photosynthetically active Photon Flux Density PPFD. We are in luck, we used Archimed-ϕ to compute the radiation interception of each organ in the example coffee plant we are using. So the only thing we need is to transform the variables given by Archimed-ϕ in each node to compute the ones we need. We use transform! from MultiScaleTreeGraph.jl to traverse the MTG and compute the right variable for each node:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"using MultiScaleTreeGraph\n\ntransform!(\n    mtg,\n    [:Ra_PAR_f, :Ra_NIR_f] => ((x, y) -> x + y * 1.2) => :Rᵢ, # This would be the incident radiation\n    [:Ra_PAR_f, :Ra_NIR_f] => ((x, y) -> x + y) => :Rₛ,\n    :Ra_PAR_f => (x -> x * 4.57) => :PPFD,\n    (x -> 0.3) => :d,\n    ignore_nothing = true\n)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"The design of MultiScaleTreeGraph.transform! is very close to the one adopted by DataFrames. It helps us compute new variables (or attributes) from others, modify their units or rename them. Here we compute Rᵢ and Rₛ from the sum of Ra_PAR_f (absorbed radiation flux in the PAR) and Ra_NIR_f (...in the NIR), PPFD from Ra_PAR_f using the conversion between W cdot m^2 to μmol cdot m^-2 cdot s^-1, and d using a constant value of 0.3 m. Note that sky_fraction is already computed for each node with the right units thanks to Archimed-ϕ, so no need to transform it.","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"Finally, we have to initialize the MTG with the models we want to use. We use init_mtg_models! from PlantSimEngine to do so:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"init_mtg_models!(mtg, models, length(weather))","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"The function takes the MTG, the models, and the number of time-steps we want to simulate, and initializes the MTG with the models, and the variables needed for the simulation. The attributes can also be modified at this stage, for example by adding the variables that will be computed by the simulation, or by pre-allocating memory for the outputs.","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"Then PlantBiophysics.jl takes care of the rest and simulates the energy balance over each time-step:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"run!(mtg, weather)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"We can visualize the outputs in 3D using PlantGeom's viz function. To do so we have to extract the time step we want to use for coloring the organs. For example if we want to color the plant according to the value of the temperature from the first time-step, we would do:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"transform!(\n    mtg,\n    :Tₗ => (x -> x[1]) => :Tₗ_1,\n    ignore_nothing = true\n)","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"And then actually plotting it:","category":"page"},{"location":"simulation/mtg_simulation/","page":"Whole-plant simulation","title":"Whole-plant simulation","text":"f, ax, p = viz(mtg, color = :Tₗ_1)\ncolorbar(f[1, 2], p)\nf","category":"page"},{"location":"variables/#Variables","page":"Variables","title":"Variables","text":"","category":"section"},{"location":"variables/","page":"Variables","title":"Variables","text":"There are so many variables in PlantBiophysics that it can be difficult to remember what is their name, what are they describing or what is their unit.","category":"page"},{"location":"variables/","page":"Variables","title":"Variables","text":"Fortunately, PlantBiophysics implements a method for the variables function from PlantSimEngine, which helps us get all variables used in PlantBiophysics:","category":"page"},{"location":"variables/","page":"Variables","title":"Variables","text":"using PlantBiophysics, PlantSimEngine\nvariables(PlantBiophysics)","category":"page"},{"location":"models/gs/#gs_page","page":"Stomatal conductance","title":"Stomatal conductance","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"The stomatal conductance (Gₛ, mol_CO_2 cdot m^-2 cdot s^-1) defines the conductance for CO₂ between the atmosphere (the air around the leaf) and the air inside the stomata. The stomatal conductance to CO₂ and H₂O are related by a constant (see gsc_to_gsw).","category":"page"},{"location":"models/gs/#Models-overview","page":"Stomatal conductance","title":"Models overview","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Several models are available to simulate it:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Medlyn: an implementation of the Medlyn et al. (2011) model\nConstantGs: a model to force a constant value for Gₛ","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"You can choose which model to use by passing a component with a stomatal conductance model set to one of the struct above.","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"For example, you can \"simulate\" a constant assimilation for a leaf using the following:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"using PlantBiophysics, PlantSimEngine\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(ConstantGs(Gₛ = 0.1))\n\nrun!(leaf,meteo)\nleaf[:Gₛ]","category":"page"},{"location":"models/gs/#Medlyn","page":"Stomatal conductance","title":"Medlyn","text":"","category":"section"},{"location":"models/gs/#param_medlyn","page":"Stomatal conductance","title":"Parameters","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"The Medlyn model has the following set of parameters:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"g0: intercept (mol_CO_2 cdot m^-2 cdot s^-1).\ng1: slope.\ngs_min = 0.001: residual conductance (mol_CO_2 cdot m^-2 cdot s^-1).","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"note: Note\nWe consider the residual conductance being different from g0 because in practice g0 can be negative when fitting real-world data.","category":"page"},{"location":"models/gs/#inputs_medlyn","page":"Stomatal conductance","title":"Input variables","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"The Medlyn model needs three input variables:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"inputs(Medlyn(0.1, 8.0))","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Dₗ (kPa) is the difference between the vapour pressure at the leaf surface and the saturated air vapour pressure, Cₛ (ppm) is the stomatal CO₂ concentration, and A is the CO₂ assimilation rate (μmol cdot m^-2 cdot s^-1)","category":"page"},{"location":"models/gs/#exemple_medlyn","page":"Stomatal conductance","title":"Example","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Here is an example usage:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"meteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(\n    Medlyn(0.03, 12.0),\n    status = (A = 20.0, Cₛ = 400.0, Dₗ = meteo.VPD)\n)\n\nrun!(leaf,meteo)\n\nleaf","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"note: Note\nYou can use inputs to get the variables needed for a given model, e.g.: inputs(Medlyn(0.03, 12.0))","category":"page"},{"location":"models/gs/#ConstantGs","page":"Stomatal conductance","title":"ConstantGs","text":"","category":"section"},{"location":"models/gs/#param_constantgs","page":"Stomatal conductance","title":"Parameters","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"The ConstantGs model has the following set of parameters:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"g0 = 0.0: intercept (mol_CO_2 cdot m^-2 cdot s^-1).\nGₛ: forced stomatal conductance.","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"This model computes the stomatal conductance using a constant value for the stomatal conductance.","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"g0 is only provided for compatibility with photosynthesis models such as Fvcb that needs a partial computation of the stomatal conductance at one point:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"(Gₛ - g0) / A","category":"page"},{"location":"models/gs/#inputs_constantgs","page":"Stomatal conductance","title":"Input variables","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"ConstantGs doesn't need any input variables.","category":"page"},{"location":"models/gs/#exemple_constantgs","page":"Stomatal conductance","title":"Example","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Here is an example usage:","category":"page"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"meteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(ConstantGs(Gₛ = 0.1))\n\nrun!(leaf,meteo)\nleaf[:Gₛ]","category":"page"},{"location":"models/gs/#References","page":"Stomatal conductance","title":"References","text":"","category":"section"},{"location":"models/gs/","page":"Stomatal conductance","title":"Stomatal conductance","text":"Medlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.","category":"page"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = PlantBiophysics","category":"page"},{"location":"#PlantBiophysics.jl","page":"Home","title":"PlantBiophysics.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"(Image: Stable) (Image: Dev) (Image: Build Status) (Image: Code Style: Blue) (Image: ColPrac: Contributor's Guide on Collaborative Practices for Community Packages)","category":"page"},{"location":"#Overview","page":"Home","title":"Overview","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"PlantBiophysics is a package to deal with biophysical processes of plants such as photosynthesis, conductances for heat, water vapor and CO₂, latent, sensible energy fluxes, net radiation and temperature. It has two main use-cases:","category":"page"},{"location":"","page":"Home","title":"Home","text":"fit the parameters of the models using the generic fit function\nsimulate the processes using the corresponding models","category":"page"},{"location":"","page":"Home","title":"Home","text":"The benefits of PlantBiophysics over existing tools are mainly:","category":"page"},{"location":"","page":"Home","title":"Home","text":"(very) fast yet interactive\neasily scalable: from single objects to whole scenes, one time step to many.\neasily extendable: make your own model, PlantBiophysics handles its coupling with others automatically\ncomposable: use Unitful to propagate units, use MonteCarloMeasurements.jl to propagate measurement error","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"To install the package, enter the Julia package manager mode by pressing ] in the REPL, and execute the following command:","category":"page"},{"location":"","page":"Home","title":"Home","text":"add PlantBiophysics","category":"page"},{"location":"","page":"Home","title":"Home","text":"To use the package, execute this command from the Julia REPL:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using PlantBiophysics","category":"page"},{"location":"#Examples","page":"Home","title":"Examples","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"See the First simulation section for examples.","category":"page"},{"location":"#Similar-projects","page":"Home","title":"Similar projects","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"A lot of similar tools exist in the wild, pick yours from this list:","category":"page"},{"location":"","page":"Home","title":"Home","text":"photosynthesis R package\nplantecophys R package\nLeafGasExchange R package\nMAESPA, not really a tool, rather a model, but the implementations of the models are heavily inspired by MAESPA.","category":"page"},{"location":"","page":"Home","title":"Home","text":"If you develop such tools and it is not on the list, please make a PR or contact me so we can add it! 😃","category":"page"},{"location":"#Related-references","page":"Home","title":"Related references","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Baldocchi, Dennis. 1994. « An analytical solution for coupled leaf photosynthesis and stomatal conductance models ». Tree Physiology 14 (7-8‑9): 1069‑79. https://doi.org/10.1093/treephys/14.7-8-9.1069.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Duursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Farquhar, G. D., S. von von Caemmerer, et J. A. Berry. 1980. « A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species ». Planta 149 (1): 78‑90.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Leuning, R., F. M. Kelliher, DGG de Pury, et E.-D. SCHULZE. 1995. « Leaf nitrogen, photosynthesis, conductance and transpiration: scaling from leaves to canopies ». Plant, Cell & Environment 18 (10): 1183‑1200.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Medlyn, B. E., D. Loustau, et S. Delzon. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. I. Seasonal changes in mature maritime pine (Pinus pinaster Ait.) ». Plant, Cell & Environment 25 (9): 1155‑65.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Medlyn, B. E., E. Dreyer, D. Ellsworth, M. Forstreuter, P. C. Harley, M. U. F. Kirschbaum, X. Le Roux, et al. 2002. « Temperature response of parameters of a biochemically based model of photosynthesis. II. A review of experimental data ». Plant, Cell & Environment 25 (9): 1167‑79. https://doi.org/10.1046/j.1365-3040.2002.00891.x.","category":"page"},{"location":"models/energy_balance/#nrj_page","page":"Energy balance","title":"Energy balance","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"using PlantBiophysics, PlantSimEngine","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"The energy balance is the process of computing the balance between influx and outflux of energy in all its form: latent and sensible heat, thermal radiation...","category":"page"},{"location":"models/energy_balance/#Models-overview","page":"Energy balance","title":"Models overview","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Only one model is available to-date:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Monteith: an implementation of the Monteith et al. (2013) model","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"You can choose which model to use by passing a model list with an energy balance model set to one of the structs above:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"using PlantBiophysics, PlantSimEngine\n\nmeteo = Atmosphere(T = 20.0, Wind = 1.0, P = 101.3, Rh = 0.65)\n\nleaf = ModelList(\n    Monteith(),\n    Fvcb(),\n    Medlyn(0.03, 12.0),\n    status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n)\n\nrun!(leaf,meteo)\nleaf[:Rn]","category":"page"},{"location":"models/energy_balance/#Monteith","page":"Energy balance","title":"Monteith","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Leaf energy balance according to Monteith and Unsworth (2013), and corrigendum from Schymanski et al. (2017). The computation is close to the one from the MAESPA model (Duursma et al., 2012, Vezy et al., 2018) here. The leaf temperature is computed iteratively to close the energy balance using the mass flux (~ Rn - λE).","category":"page"},{"location":"models/energy_balance/#param_monteith","page":"Energy balance","title":"Parameters","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"The Monteith model has the following set of parameters:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"aₛₕ = 2: number of faces of the object that exchange sensible heat fluxes\naₛᵥ = 1: number of faces of the object that exchange latent heat fluxes (hypostomatous => 1)\nε = 0.955: emissivity of the object\nmaxiter = 10: maximal number of iterations allowed to close the energy balance\nΔT = 0.01 (°C): maximum difference in object temperature between two iterations to consider convergence","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"note: Note\nObjects are surfaces, not volumes, so the maximum number of faces is two.","category":"page"},{"location":"models/energy_balance/#inputs_monteith","page":"Energy balance","title":"Input variables","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"The Monteith model needs three input variables:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"inputs(Monteith())","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Rₛ (W m-2) is the net shortwave radiation (PAR + NIR), most often computed from a light interception model. sky_fraction (0-2) is the fraction of sky the object is viewing compared to everything else. It is given for the 360° viewing angle, i.e. for both faces. d (m) is the characteristic dimension, e.g. the leaf width (see eq. 10.9 from Monteith and Unsworth, 2013).","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"note: Note\nsky_fraction is equal to 2 if the leaf is viewing sky only (e.g. in a controlled chamber with lights everywhere), 1 if the leaf is e.g. up on the canopy where the upper side of the leaf sees sky, and the bottom side sees soil and other components, or less than 1 if it is partly shaded. sky_fraction is used to compute the thermal radiation exchanges. Everything except the sky is considered at the same temperature than the object. This simplification makes the computations very fast, but less precise, especially when another object has a very different temperature.","category":"page"},{"location":"models/energy_balance/#outputs_monteith","page":"Energy balance","title":"Output variables","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"The Monteith model computes a lot of variables, mainly because it is also coupled to a photosynthesis model, itself potentially coupled to a stomatal conductance model:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"outputs(Monteith())","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Tₗ (°C) is the component temperature, Rn (W cdot m^-2) is the net radiation (PAR + NIR + TIR), Rₗₗ (W cdot m^-2) is the longwave radiation (TIR), H (W cdot m^-2) is the sensible heat flux, λE (W cdot m^-2) is the latent heat flux, Cₛ (ppm) is the stomatal CO₂ concentration, Cᵢ (ppm) is the intercellular CO₂ concentration, A (μmol cdot m^-2 cdot s^-1) is the CO₂ assimilation rate, Gₛ (mol_CO_2 cdot m^-2 cdot s^-1) the stomatal conductance, Gbₕ (m cdot s^-1) the boundary layer conductance to heat, Dₗ (kPa) the difference between the vapour pressure at the leaf surface and the saturated air vapour pressure, Gbc (mol_CO_2 cdot m^-2 cdot s^-1) the boundary layer conductance to CO₂, and iter the number of iterations to reach convergence.","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"note: Note\nThe output variables depends on the models we are using for photosynthesis and stomatal conductance.","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"note: Note\nConvergence is reached whenever the difference in the component temperature (Tₗ, °C) between two time-steps is lower than ΔT.","category":"page"},{"location":"models/energy_balance/#exemple_monteith","page":"Energy balance","title":"Example","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Here is an example usage:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"meteo = Atmosphere(T = 22.0, Wind = 0.8333, P = 101.325, Rh = 0.4490995)\n\nleaf = ModelList(\n    Monteith(),\n    Fvcb(),\n    Medlyn(0.03, 12.0),\n    status = (Rₛ = 13.747, sky_fraction = 1.0, PPFD = 1500.0, d = 0.03)\n)\n\nleaf","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"The Monteith model implementation can be tested on the data provided by Schymanski et al. (2017). Here is a figure comparing our implementation and the data:","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"include(\"./schymanski.jl\")","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"(Image: )","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Figure 1. Energy flux measured on an artificial leaf (points) or simulated from its digital twin (lines). Data from Schymanski et al. (2017) figure 6a. The code to reproduce this figure is available in this file.","category":"page"},{"location":"models/energy_balance/#References","page":"Energy balance","title":"References","text":"","category":"section"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Duursma, R. A., et B. E. Medlyn. 2012. « MAESPA: a model to study interactions between water limitation, environmental drivers and vegetation function at tree and stand levels, with an example application to [CO2] × drought interactions ». Geoscientific Model Development 5 (4): 919‑40. https://doi.org/10.5194/gmd-5-919-2012.","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Monteith, John L., et Mike H. Unsworth. 2013. « Chapter 13 - Steady-State Heat Balance: (i) Water Surfaces, Soil, and Vegetation ». In Principles of Environmental Physics (Fourth Edition), edited by John L. Monteith et Mike H. Unsworth, 217‑47. Boston: Academic Press.","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Schymanski, Stanislaus J., et Dani Or. 2017. « Leaf-Scale Experiments Reveal an Important Omission in the Penman–Monteith Equation ». Hydrology and Earth System Sciences 21 (2): 685‑706. https://doi.org/10.5194/hess-21-685-2017.","category":"page"},{"location":"models/energy_balance/","page":"Energy balance","title":"Energy balance","text":"Vezy, Rémi, Mathias Christina, Olivier Roupsard, Yann Nouvellon, Remko Duursma, Belinda Medlyn, Maxime Soma, et al. 2018. « Measuring and modelling energy partitioning in canopies of varying complexity using MAESPA model ». Agricultural and Forest Meteorology 253‑254 (printemps): 203‑17. https://doi.org/10.1016/j.agrformet.2018.02.005.","category":"page"}]
}
