<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial: Uncertainty propagation · PlantBiophysics.jl</title><meta name="title" content="Tutorial: Uncertainty propagation · PlantBiophysics.jl"/><meta property="og:title" content="Tutorial: Uncertainty propagation · PlantBiophysics.jl"/><meta property="twitter:title" content="Tutorial: Uncertainty propagation · PlantBiophysics.jl"/><meta name="description" content="Documentation for PlantBiophysics.jl."/><meta property="og:description" content="Documentation for PlantBiophysics.jl."/><meta property="twitter:description" content="Documentation for PlantBiophysics.jl."/><meta property="og:url" content="https://VEZY.github.io/PlantBiophysics.jl/simulation/uncertainty_propagation/"/><meta property="twitter:url" content="https://VEZY.github.io/PlantBiophysics.jl/simulation/uncertainty_propagation/"/><link rel="canonical" href="https://VEZY.github.io/PlantBiophysics.jl/simulation/uncertainty_propagation/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="PlantBiophysics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PlantBiophysics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../../getting_started/get_started/">TL;DR</a></li><li><a class="tocitem" href="../../getting_started/first_fit/">Parameter fitting</a></li></ul></li><li><a class="tocitem" href="../../concepts/package_design/">Design</a></li><li><a class="tocitem" href="../../variables/">Variables</a></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../../models/photosynthesis/">Photosynthesis</a></li><li><a class="tocitem" href="../../models/gs/">Stomatal conductance</a></li><li><a class="tocitem" href="../../models/energy_balance/">Energy balance</a></li><li><a class="tocitem" href="../../models/light/">Light interception</a></li></ul></li><li><a class="tocitem" href="../../climate/microclimate/">Micro-climate</a></li><li><a class="tocitem" href="../../fitting/parameter_fitting/">Tutorial: Parameter fitting</a></li><li><span class="tocitem">Tutorial: Simulation</span><ul><li><a class="tocitem" href="../first_simulation/">Simple Simulation</a></li><li><a class="tocitem" href="../several_simulation/">Several time steps</a></li><li><a class="tocitem" href="../several_objects_simulation/">Several objects</a></li><li><a class="tocitem" href="../mtg_simulation/">Whole-plant simulation</a></li></ul></li><li class="is-active"><a class="tocitem" href>Tutorial: Uncertainty propagation</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Example:-normal-distributions"><span>Example: normal distributions</span></a></li><li><a class="tocitem" href="#Example:-other-distributions"><span>Example: other distributions</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Tips-in-case-of-errors"><span>Tips in case of errors</span></a></li></ul></li><li><span class="tocitem">Extending PlantBiophysics</span><ul><li><a class="tocitem" href="../../extending/implement_a_model/">Implement a model</a></li><li><a class="tocitem" href="../../extending/implement_a_process/">Implement a process</a></li></ul></li><li><a class="tocitem" href="../../functions/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial: Uncertainty propagation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial: Uncertainty propagation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VEZY/PlantBiophysics.jl/blob/master/docs/src/simulation/uncertainty_propagation.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="uncertainty_propagation_page"><a class="docs-heading-anchor" href="#uncertainty_propagation_page">Uncertainty propagation</a><a id="uncertainty_propagation_page-1"></a><a class="docs-heading-anchor-permalink" href="#uncertainty_propagation_page" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>We can very easily propagate uncertainties in all computations in PlantBiophysics using either <a href="https://github.com/JuliaPhysics/Measurements.jl">Measurements.jl</a> or <a href="https://github.com/baggepinnen/MonteCarloMeasurements.jl">MonteCarloMeasurements.jl</a>. So instead of using classic data types such as <code>Float64</code> for parameter values, micro-meteorological conditions or initial values, we use a specific data type that propagates distributions rather than scalars.</p><p><a href="https://github.com/JuliaPhysics/Measurements.jl">Measurements.jl</a> provides a very fast way to propagate errors, but is only suited for linear processes. <a href="https://github.com/baggepinnen/MonteCarloMeasurements.jl">MonteCarloMeasurements.jl</a> in the other hand is slower but provides a better estimation of the propagation for non-linear processes. The main idea of Monte Carlo methods is to simulate the problem for a large number of times, randomly drawing inputs in the distributions specified by the user. We then get distributions as outputs (and means/standard deviations).</p><h2 id="Example:-normal-distributions"><a class="docs-heading-anchor" href="#Example:-normal-distributions">Example: normal distributions</a><a id="Example:-normal-distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-normal-distributions" title="Permalink"></a></h2><p>Let&#39;s first import all packages we need:</p><pre><code class="language-julia hljs">using PlantBiophysics, PlantSimEngine, PlantMeteo, MonteCarloMeasurements, Plots, Dates
# Toggle the use of a comparison function (using `mean`):
unsafe_comparisons(true)</code></pre><p>We can use the <code>μ ± σ</code> notation for the values of the parameters and micro-meteorological conditions to create a Gaussian distribution (of mean μ and standard deviation σ):</p><pre><code class="language-julia hljs">meteo = Atmosphere(T = 22.0 ± 0.1, Wind = 0.8333 ± 0.1, P = 101.325 ± 1., Rh = 0.4490995 ± 0.02, Cₐ = 400. ± 1.)

leaf = ModelList(
        Monteith(),
        Fvcb(),
        Medlyn(0.03, 12.0),
        status = (Ra_SW_f = 13.747 ± 1., sky_fraction = 1.0, aPPFD = 1500.0 ± 1., d = 0.03 ± 0.001),
        type_promotion = Dict(Float64 =&gt; Particles{Float64,2000})
    )</code></pre><p>Now our parameters and conditions are not scalars, but <code>Particles</code>, which are <code>n</code> sampled values in the <code>μ ± σ</code> distributions. By default <code>n = 2000</code>.</p><p>We can now run our simulation:</p><pre><code class="language-julia hljs">run!(leaf,meteo)</code></pre><p>And now we can plot the resulting inputs/outputs values:</p><pre><code class="language-julia hljs">p1 = plot(meteo.T,legend=:false,xlabel=&quot;Tₐ (°C)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(a)&quot;,titlefontsize=9)
p2 = plot(leaf.status.d[1],legend=:false,xlabel=&quot;d (m)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(b)&quot;,titlefontsize=9)
p3 = plot(leaf.status.Tₗ[1],legend=:false,xlabel=&quot;Tₗ (°C)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(c)&quot;,titlefontsize=9)
p4 = plot(leaf.status.A[1],legend=:false,xlabel=&quot;A&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(d)&quot;,titlefontsize=9)
plot(p1,p2,p3,p4,dpi=300,titleloc=:right)</code></pre><p><img src="../distributions-example-gaussian.svg" alt/></p><h2 id="Example:-other-distributions"><a class="docs-heading-anchor" href="#Example:-other-distributions">Example: other distributions</a><a id="Example:-other-distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-other-distributions" title="Permalink"></a></h2><p>It is also possible to use other types of distributions. For example the <code>a .. b</code> notation will set a uniform distribution in the interval <code>[a,b]</code>). For others distributions, you can use the package <a href="https://github.com/JuliaStats/Distributions.jl">Distributions.jl</a> to use any other distributions (Binomial, Gamma, etc...) as <code>a ⊠ Gamma(1)</code> (<em>i.e.</em> <code>a</code> plus a Gamma distribution of parameter 1) or <code>a ⊠ Exponential(1)</code> (<em>i.e.</em> an exponential distribution of parameter 1 with <code>a</code> as factor).</p><p>Here&#39;s an example usage:</p><pre><code class="language-julia hljs"># ⊞ \boxplus
# ⊠ \boxtimes

meteo = Atmosphere(T = 15.0 .. 18.0, Wind = 0.8333 ± 0.1, P = 101.325 ± 1., Rh = 0.4490995 ± 0.02, Cₐ = 400. ± 1.)

leaf = ModelList(
        Monteith(),
        Fvcb(),
        Medlyn(0.03, 12.0),
        status = (Ra_SW_f = 13.747 ± 1., sky_fraction = 1.0, aPPFD = 1500.0 ± 1., d = 0.01 .. 0.03),
        type_promotion = Dict(Float64 =&gt; Particles{Float64,2000})
    )

run!(leaf,meteo)

p1 = plot(meteo.T,legend=:false,xlabel=&quot;Tₐ (°C)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(a)&quot;,titlefontsize=9)
p2 = plot(leaf.status.d[1],legend=:false,xlabel=&quot;d (m)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(b)&quot;,titlefontsize=9)
p3 = plot(leaf.status.Tₗ[1],legend=:false,xlabel=&quot;Tₗ (°C)&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(c)&quot;,titlefontsize=9)
p4 = plot(leaf.status.A[1],legend=:false,xlabel=&quot;A&quot;,ylabel=&quot;density&quot;,dpi=300,title=&quot;(d)&quot;,titlefontsize=9)
plot(p1,p2,p3,p4,dpi=300,titleloc=:right)</code></pre><p><img src="../distributions-example-various.svg" alt/></p><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>Plotting values of type <code>MonteCarloMeasurements.jl</code> is allowed using <code>plot</code> as it were scalars. It will plot confidence interval too. You can also check specific <code>MonteCarloMeasurements.jl</code> function <code>ribbonplot</code> (more details in part <code>Plotting</code> of the package documentation).</p><p>For example we can simulate a leaf energy balance over consecutive time-steps:</p><pre><code class="language-julia hljs">weather = read_weather(
    joinpath(dirname(dirname(pathof(PlantMeteo))), &quot;test&quot;, &quot;data&quot;, &quot;meteo.csv&quot;),
    :temperature =&gt; :T,
    :relativeHumidity =&gt; (x -&gt; x ./ 100) =&gt; :Rh,
    :wind =&gt; :Wind,
    :atmosphereCO2_ppm =&gt; :Cₐ,
    date_format = DateFormat(&quot;yyyy/mm/dd&quot;)
)

leaf = ModelList(
        Monteith(),
        Fvcb(),
        Medlyn(0.03, 12.0),
        status = (Ra_SW_f = 13.747 ± 2., sky_fraction = 0.6..1.0, aPPFD = 1500.0 ± 100., d = [0.03,0.03,0.03]),
        type_promotion = Dict(Float64 =&gt; Particles{Float64,2000})
    )

run!(leaf, weather)

ribbonplot(weather[:date], leaf[:Tₗ], alpha = 0.2, ylab = &quot;Leaf Temperature&quot;, xlab = &quot;Time&quot;)</code></pre><p><img src="../error-ribbon.svg" alt/></p><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><p>Monte Carlo results are highly dependent on the number of simulations given by the number of particles <code>n</code>, slowing the performance of the package. But keep in mind that the result of an uncertainty propagation with a low <code>n</code> is less reliable than with a higher <code>n</code>.</p><h2 id="Tips-in-case-of-errors"><a class="docs-heading-anchor" href="#Tips-in-case-of-errors">Tips in case of errors</a><a id="Tips-in-case-of-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Tips-in-case-of-errors" title="Permalink"></a></h2><p>When using uncertainty distributions, it is important to consider the nature of the input variables. For example, certain variables such as characteristic length must be positive values only, and using inappropriate uncertainty distributions, like a Gaussian extending to negative values, will lead to error. You should exercise caution and select appropriate uncertainty distributions that align with the characteristics of the variables being modeled. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mtg_simulation/">« Whole-plant simulation</a><a class="docs-footer-nextpage" href="../../extending/implement_a_model/">Implement a model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 29 November 2024 14:11">Friday 29 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
